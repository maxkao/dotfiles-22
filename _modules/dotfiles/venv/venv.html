<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- OpenGraph metadata: ogp.me -->
    <meta property="og:title" content="dotfiles.venv.venv" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="westurner/dotfiles" />
    <!--
    <meta property="og:description" content="Documentation for the dotfiles project" />
    -->
    <meta property="og:image" content="" />
    <meta property="og:image:width" content="470" />
    <meta property="og:image:height" content="242" />
    <!--
    <meta property="og:image:secure_url" content="./_static/img/logo.png" />
    -->
    <!-- Twitter metadata -->
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:title" content="dotfiles.venv.venv" />
    <meta property="twitter:description" content="Documentation for the dotfiles project" />
    <meta property="twitter:site" content="westurner" />
    <meta property="twitter:creator" content="westurner" />
    
    <title>dotfiles.venv.venv &mdash; westurner/dotfiles 0.9.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../../_static/css/font-awesome.min.css">

<link rel="stylesheet" href="../../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
<link rel="stylesheet" href="../../../_static/css/local.css" type="text/css" />
<link rel="stylesheet" href="../../../_static/changelog.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../../',
            VERSION:     '0.9.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/js/local.js"></script>
    <script type="text/javascript" src="../../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="top" title="westurner/dotfiles 0.9.0 documentation" href="../../../index.html" />
    <link rel="up" title="dotfiles" href="../../dotfiles.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../index.html">westurner/dotfiles 0.9.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">

            
              <li><a href="../../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../../index.html" >Module code</a></li>
              <li><a href="../../dotfiles.html" accesskey="U">dotfiles</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div><div class="widget">
    <h3><a href="https://westurner.org/">@westurner</a></h3>
    <ul>
        <li><a href="https://github.com/westurner/dotfiles">github.com/westurner/dotfiles</a></li>
        <li><a href="https://westurner.org/dotfiles/">westurner.org/dotfiles/</a></li>
        <li><a href="https://westurner.org/wiki/">westurner.org/wiki/</a></li>
    </ul>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for dotfiles.venv.venv</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># encoding: utf-8</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">dotfiles.venv.venv_ipyconfig</span>
<span class="sd">==============================</span>
<span class="sd">venv_ipyconfig.py (venv)</span>

<span class="sd">Create virtual environment configurations</span>
<span class="sd">with a standard filesystem hierarchy overlay</span>
<span class="sd">and cd aliases for Bash, ZSH, Vim, and IPython</span>
<span class="sd">for use with virtualenv, virtualevwrapper,</span>
<span class="sd">and anything that has or should have</span>
<span class="sd">a prefix like ``VIRTUAL_ENV`` and</span>
<span class="sd">directories like</span>
<span class="sd">``./bin``, ``./etc``, ``./var/log``, and ``./src``.</span>

<span class="sd">Functional comparisons:</span>

<span class="sd">* T-Square, Compass, Table Sled, Stencil, Template, Floorplan, Lens</span>


<span class="sd">Venv Implementation</span>
<span class="sd">-------------------</span>

<span class="sd">- create an :py:mod:`Env` (``env = Env()``)</span>
<span class="sd">- define ``__WRK`` workspace root</span>
<span class="sd">- define ``VIRTUAL_ENV``, ``_SRC``, ``_ETC``, ``_WRD``</span>
<span class="sd">- define ``WORKON_HOME``</span>

<span class="sd">- create and add :py:mod:`Steps` (``builder.add_step(step_func)``)</span>

<span class="sd">  - define variables like ``env[&#39;__WRK&#39;]`` (``Venv.env.environ[&#39;PATH&#39;]``)</span>
<span class="sd">  - define IPython shell command aliases (``Env.aliases``,</span>
<span class="sd">    ``e``, ``ps``, ``git``, ``gitw``)</span>

<span class="sd">- create a :py:mod:`StepBuilder` (``builder = StepBuilder()``)</span>
<span class="sd">- build a new env from steps: ``new_env = builder.build(env)``</span>

<span class="sd">- print an :py:mod:`Env`to:</span>

<span class="sd">  - ``--print-json`` -- JSON (Env.to_dict, Env.to_json)</span>
<span class="sd">  - ``--print-ipython`` -- IPython configuration (Env.environ, Env.aliases)</span>
<span class="sd">  - ``--print-bash`` -- Bash configuration (Env.environ, Env.aliases)</span>
<span class="sd">  - ``--print-bash-cdalias`` -- Bash configuration (Env.environ, Env.aliases)</span>
<span class="sd">  - ``--print-zsh`` ZSH -- configuration (Env.environ, Env.aliases)</span>
<span class="sd">  - ``--print-zsh-cdalias`` -- ZSH configuration (Env.environ, Env.aliases)</span>
<span class="sd">  - ``--print-vim-cdalias`` -- Vim configuration (Env.aliases)</span>

<span class="sd">- generate and source CdAliases that expand and complete where possible</span>
<span class="sd">  (``cdwrk``, ``cdwrd``, ``cdw``)</span>

<span class="sd">  - define CdAliases in venv_ipyconfig.py (this file)</span>
<span class="sd">  - generate venv.sh (``cdwrk``)</span>
<span class="sd">  - generate venv.vim (``:Cdwrk``)</span>
<span class="sd">  - generate venv_cdmagic.py (``%cdwrk``, ``cdwrk``)</span>


<span class="sd">.. note::</span>

<span class="sd">   This module may only import from the Python standard library,</span>
<span class="sd">   so that it always works as ``~/.ipython/profile_default/venv_ipyconfig.py``</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="kn">import</span> <span class="nn">distutils.spawn</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">site</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">joinpath</span>

<span class="c1"># try/except imports for IPython</span>
<span class="c1"># import IPython</span>
<span class="c1"># import zmq</span>
<span class="c1">## import sympy</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">STR_TYPES</span> <span class="o">=</span> <span class="n">basestring</span>
    <span class="n">str_center</span> <span class="o">=</span> <span class="n">unicode</span><span class="o">.</span><span class="n">center</span>
    <span class="kn">import</span> <span class="nn">StringIO</span> <span class="k">as</span> <span class="nn">StringIO_</span>
    <span class="n">StringIO</span> <span class="o">=</span> <span class="n">StringIO_</span><span class="o">.</span><span class="n">StringIO</span>

    <span class="c1"># workaround for Sphinx autodoc bug</span>
    <span class="kn">import</span> <span class="nn">__builtin__</span>

    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">__builtin__</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">STR_TYPES</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="n">str_center</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">center</span>
    <span class="kn">import</span> <span class="nn">io</span>
    <span class="n">StringIO</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span>

<span class="n">LOGNAME</span> <span class="o">=</span> <span class="s1">&#39;venv&#39;</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">LOGNAME</span><span class="p">)</span>

<span class="n">__THISFILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="c1">#  __VENV_CMD = &quot;python {~venv_ipyconfig.py}&quot;</span>
<span class="c1">#  __VENV_CMD = &quot;python %s&quot; % __THISFILE</span>

<span class="n">IN_IPYTHON</span> <span class="o">=</span> <span class="s1">&#39;get_ipython&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span>
<span class="n">IN_IPYTHON_CONFIG</span> <span class="o">=</span> <span class="s1">&#39;get_config&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span>
<span class="c1">#print((&quot;IN_IPYTHON&quot;, IN_IPYTHON))</span>
<span class="c1">#print((&quot;IN_IPYTHON_CONFIG&quot;, IN_IPYTHON_CONFIG))</span>

<span class="k">if</span> <span class="n">IN_IPYTHON_CONFIG</span><span class="p">:</span>
    <span class="n">IPYTHON_CONFIG</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">IPYTHON_CONFIG</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="in_venv_ipyconfig"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.in_venv_ipyconfig">[docs]</a><span class="k">def</span> <span class="nf">in_venv_ipyconfig</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if ``get_ipython`` is in ``globals()``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">IN_IPYTHON_CONFIG</span></div>

<span class="n">DEBUG_TRACE_MODPATH</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="logevent"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.logevent">[docs]</a><span class="k">def</span> <span class="nf">logevent</span><span class="p">(</span><span class="n">event</span><span class="p">,</span>
             <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">logger</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
             <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
             <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">lineno</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">modpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">show_modpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">wrap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">splitlines</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        event (str): an event key</span>
<span class="sd">        obj (thing): thing to serialize and log</span>
<span class="sd">        logger (logging.Logger): logger to log to</span>
<span class="sd">        level (int): logging loglevel to log (event, obj)</span>
<span class="sd">        wrap (bool): Add header and footer &lt;event&gt; tags (default: False)</span>
<span class="sd">        splitlines (bool): split by newlines and emit one log message per line</span>
<span class="sd">    Returns:</span>
<span class="sd">        tuple: (event:str, output:str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eventstr</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;tab/&gt;&#39;</span><span class="p">)</span>     <span class="c1"># XXX: raises</span>

    <span class="k">if</span> <span class="n">show_modpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">show_modpath</span> <span class="o">=</span> <span class="n">DEBUG_TRACE_MODPATH</span>

    <span class="k">if</span> <span class="n">show_modpath</span> <span class="ow">and</span> <span class="n">modpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">modpath</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_frame</span> <span class="o">=</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_frame</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&lt;module&gt;&#39;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">_frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span>
            <span class="n">modpath</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">_frame</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">))</span>
            <span class="k">while</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_frame</span><span class="p">,</span> <span class="s1">&#39;f_back&#39;</span><span class="p">):</span>
                <span class="n">_frame</span> <span class="o">=</span> <span class="n">_frame</span><span class="o">.</span><span class="n">f_back</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_frame</span><span class="p">,</span> <span class="s1">&#39;f_code&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_frame</span><span class="p">,</span> <span class="s1">&#39;f_lineno&#39;</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&lt;module&gt;&#39;</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">_frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">],</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="n">modpath</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">_frame</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_frame</span><span class="p">,</span> <span class="s1">&#39;f_globals&#39;</span><span class="p">):</span>
                <span class="n">modpath</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s1">&#39;__name__&#39;</span><span class="p">]</span>

    <span class="n">funcstr</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">funcstr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span>
                            <span class="n">func</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">STR_TYPES</span><span class="p">)</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">modpath</span><span class="p">:</span>
            <span class="n">modpath</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">funcstr</span><span class="p">,))</span>

    <span class="k">if</span> <span class="n">modpath</span><span class="p">:</span>
        <span class="n">funcstr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> +</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">modpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_event_prefix</span><span class="p">(</span><span class="n">eventstr</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">funcstr</span><span class="o">=</span><span class="n">funcstr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">funcstr</span><span class="p">:</span>
            <span class="n">fmtstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{eventstr}</span><span class="se">\t</span><span class="si">{line}</span><span class="se">\t</span><span class="s1">##</span><span class="si">{funcstr}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmtstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{eventstr}</span><span class="se">\t</span><span class="si">{line}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">fmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">eventstr</span><span class="o">=</span><span class="n">eventstr</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
            <span class="n">funcstr</span><span class="o">=</span><span class="n">funcstr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">add_event_prefix</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">output</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">wrap</span><span class="p">:</span>
        <span class="n">_log</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;# &lt;</span><span class="si">{eventstr}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eventstr</span><span class="o">=</span><span class="n">eventstr</span><span class="p">))</span>

    <span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;to_json&#39;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">splitlines</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">_log</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>  <span class="c1"># TODO: comment?</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_log</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">wrap</span><span class="p">:</span>
        <span class="n">_log</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;# &lt;/</span><span class="si">{eventstr}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eventstr</span><span class="o">=</span><span class="n">eventstr</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span></div>


<span class="c1"># Exception classes</span>

<div class="viewcode-block" id="ConfigException"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.ConfigException">[docs]</a><span class="k">class</span> <span class="nc">ConfigException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StepException"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.StepException">[docs]</a><span class="k">class</span> <span class="nc">StepException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="StepConfigException"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.StepConfigException">[docs]</a><span class="k">class</span> <span class="nc">StepConfigException</span><span class="p">(</span><span class="n">StepException</span><span class="p">,</span> <span class="n">ConfigException</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="prepend_comment_char"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.prepend_comment_char">[docs]</a><span class="k">def</span> <span class="nf">prepend_comment_char</span><span class="p">(</span><span class="n">strblock</span><span class="p">,</span> <span class="n">commentchar</span><span class="o">=</span><span class="s2">&quot;##&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        strblock (str): string to split by newlines and prepend</span>
<span class="sd">        prefix (str): comment string prefix (one space will be added)</span>
<span class="sd">    Yields:</span>
<span class="sd">        str: lines prefixed with prefix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">strblock</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">yield</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">commentchar</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span></div>


<span class="c1"># Constant getters (for now)</span>

<div class="viewcode-block" id="get_pyver"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.get_pyver">[docs]</a><span class="k">def</span> <span class="nf">get_pyver</span><span class="p">(</span><span class="n">pyverstr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        pyver (str): &quot;major.minor&quot; e.g. ``2.7`` or ``3.4``</span>
<span class="sd">            (default: ``sys.version_info[:2]``)</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: ``python2.7``, ``python.34``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pyverstr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pyver</span> <span class="o">=</span> <span class="s1">&#39;python</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pyver</span> <span class="o">=</span> <span class="s1">&#39;python</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pyverstr</span>
    <span class="k">return</span> <span class="n">pyver</span></div>


<div class="viewcode-block" id="get___WRK_default"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.get___WRK_default">[docs]</a><span class="k">def</span> <span class="nf">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
    <span class="n">__WRK</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                       <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                               <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/-wrk&#39;</span><span class="p">)))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get__WRK</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;__WRK&#39;</span><span class="p">:</span> <span class="n">__WRK</span><span class="p">,</span>
                                <span class="s1">&#39;env[__WRK]&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">__WRK</span></div>


<div class="viewcode-block" id="get_WORKON_HOME_default"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.get_WORKON_HOME_default">[docs]</a><span class="k">def</span> <span class="nf">get_WORKON_HOME_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">from_environ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;-ve27&#39;</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">        env (dict): Env dict to read from (default: None)</span>
<span class="sd">        from_environ (bool): read WORKON_HOME from os.environ</span>
<span class="sd">        default (str): default WORKON_HOME dirname</span>
<span class="sd">        __WRK (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: path to a ``WORKON_HOME`` directory</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__WORKON_HOME_DEFAULT</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">from_environ</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="o">.</span><span class="n">from_environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>  <span class="c1"># TODO: os.environ.copy()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                              <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                                      <span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)))</span>
    <span class="n">workon_home</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">)</span>  <span class="c1"># TODO: WORKON_HOME_DEFAULT</span>
    <span class="k">if</span> <span class="n">workon_home</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">workon_home</span>
    <span class="n">python27_home</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME__py27&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">python27_home</span><span class="p">:</span>
        <span class="n">workon_home</span> <span class="o">=</span> <span class="n">python27_home</span>
        <span class="k">return</span> <span class="n">workon_home</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">python27_home</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="n">__WORKON_HOME_DEFAULT</span><span class="p">)</span>
        <span class="n">workon_home</span> <span class="o">=</span> <span class="n">python27_home</span>
        <span class="k">return</span> <span class="n">workon_home</span>
    <span class="n">workon_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.virtualenvs/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">workon_home</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">workon_home</span>
    <span class="n">workon_home</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="n">__WORKON_HOME_DEFAULT</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">workon_home</span></div>


<div class="viewcode-block" id="VenvJSONEncoder"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.VenvJSONEncoder">[docs]</a><span class="k">class</span> <span class="nc">VenvJSONEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>

<div class="viewcode-block" id="VenvJSONEncoder.default"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.VenvJSONEncoder.default">[docs]</a>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;to_dict&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">):</span>
            <span class="c1"># TODO: why is this necessary?</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;to_bash_function&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_bash_function</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;to_shell_str&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_shell_str</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">CdAlias</span><span class="p">):</span>
            <span class="c1"># return dict(type=&quot;cdalias&quot;,value=(obj.name, obj.pathvar))</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div></div>

<span class="c1">##############</span>
<span class="c1"># define aliases as IPython aliases (which support %l and %s,%s)</span>
<span class="c1"># which can then be transformed to:</span>
<span class="c1"># * ipython aliases (&quot;echo %l; ping -t %s -n %s&quot;)</span>


<div class="viewcode-block" id="CmdAlias"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CmdAlias">[docs]</a><span class="k">class</span> <span class="nc">CmdAlias</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmdstr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            cmdstr (str): command alias</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="o">=</span> <span class="n">cmdstr</span>

<div class="viewcode-block" id="CmdAlias.to_shell_str"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CmdAlias.to_shell_str">[docs]</a>    <span class="k">def</span> <span class="nf">to_shell_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an alias or function for bash/zsh</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            name (str): funcname to override default</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: self.cmdstr (AS-IS)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span></div>

<div class="viewcode-block" id="CmdAlias.to_ipython_alias"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CmdAlias.to_ipython_alias">[docs]</a>    <span class="k">def</span> <span class="nf">to_ipython_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an alias for IPython</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: self.cmdstr (AS-IS)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span></div>

    <span class="c1">#def to_vim_function(self):</span>
    <span class="c1">#    &quot;&quot;&quot;</span>
    <span class="c1">#    Generate a vim function</span>

    <span class="c1">#    Raises:</span>
    <span class="c1">#        NotImplemented: See IpyAlias.to_vim_function</span>
    <span class="c1">#        str: self.cmdstr (AS-IS)</span>
    <span class="c1">#    &quot;&quot;&quot;</span>
    <span class="c1">#    raise NotImplemented</span>

    <span class="fm">__str__</span> <span class="o">=</span> <span class="n">to_shell_str</span>
    <span class="fm">__repr__</span> <span class="o">=</span> <span class="n">to_shell_str</span></div>


<div class="viewcode-block" id="IpyAlias"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.IpyAlias">[docs]</a><span class="k">class</span> <span class="nc">IpyAlias</span><span class="p">(</span><span class="n">CmdAlias</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An IPython alias command string</span>
<span class="sd">    which expands to a shell function ``aliasname() { ... }``</span>
<span class="sd">    and handles positional args ``%s`` and ``%l``</span>

<span class="sd">    References:</span>

<span class="sd">        * TODO: IPython docs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmdstr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">complfuncstr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            cmdstr (str): if cmdstr contains ``%s`` or ``%l``,</span>
<span class="sd">                it will be expanded to a shell function</span>
<span class="sd">        Keyword Arguments:</span>
<span class="sd">            name (str): None to set at serialization</span>
<span class="sd">                (so that ``$ type cmd`` shows the actual command)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="o">=</span> <span class="n">cmdstr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complfuncstr</span> <span class="o">=</span> <span class="n">complfuncstr</span>

<div class="viewcode-block" id="IpyAlias.to_shell_str"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.IpyAlias.to_shell_str">[docs]</a>    <span class="k">def</span> <span class="nf">to_shell_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an alias or function for bash/zsh</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            name (str): funcname to override default</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: an ``alias`` or a ``function()``</span>

<span class="sd">            .. code:: bash</span>

<span class="sd">                alias name=repr(cmdstr)</span>
<span class="sd">                # or</span>
<span class="sd">                cmdname () {</span>
<span class="sd">                    cmdstr</span>
<span class="sd">                }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">alias</span> <span class="ow">or</span> <span class="s1">&#39;%l&#39;</span> <span class="ow">in</span> <span class="n">alias</span><span class="p">:</span>
            <span class="c1"># alias = &#39;# %s&#39; % alias</span>
            <span class="c1"># chunks = alias.split(&#39;%s&#39;)</span>
            <span class="n">_alias</span> <span class="o">=</span> <span class="n">alias</span><span class="p">[:]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">_alias</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">_alias</span> <span class="o">=</span> <span class="n">_alias</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;${</span><span class="si">%d</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">_aliasmacro_tmpl</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">u</span><span class="s1">&#39;eval </span><span class="se">\&#39;</span><span class="si">{funcname}</span><span class="s1"> () {{</span><span class="se">\n</span><span class="s1">    </span><span class="si">{funcstr}</span><span class="se">\n</span><span class="s1">}}</span><span class="se">\&#39;</span><span class="s1">;&#39;</span><span class="p">)</span>
            <span class="n">_aliasmacro</span> <span class="o">=</span> <span class="n">_aliasmacro_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">funcname</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">funcstr</span><span class="o">=</span><span class="n">_alias</span><span class="p">)</span>
            <span class="n">_aliasmacro</span> <span class="o">=</span> <span class="n">_aliasmacro</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%l&#39;</span><span class="p">,</span> <span class="s1">&#39;${@}&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">complfuncstr</span><span class="p">:</span>
                <span class="n">complfuncname</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">__complete&#39;</span> <span class="o">%</span> <span class="n">name</span>
                <span class="n">_aliasmacro</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">complete -o default -o nospace -F </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> ;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">_aliasmacro</span><span class="p">,</span>
                    <span class="n">_aliasmacro_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">funcname</span><span class="o">=</span><span class="n">complfuncname</span><span class="p">,</span>
                        <span class="n">funcstr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">complfuncstr</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span>
                    <span class="n">complfuncname</span><span class="p">,</span>
                    <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_aliasmacro</span>

        <span class="c1"># TODO: repr(alias) / shell_quote / mangling #XXX</span>
        <span class="k">return</span> <span class="s1">&#39;alias </span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1"> ;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">alias</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="CdAlias"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CdAlias">[docs]</a><span class="k">class</span> <span class="nc">CdAlias</span><span class="p">(</span><span class="n">CmdAlias</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A CmdAlias for ``cd`` change directory</span>
<span class="sd">    functions with venv paths (e.g. $_WRD)</span>
<span class="sd">    for Bash, ZSH, IPython, Vim.</span>

<span class="sd">    * venv.sh bash functions with tab-completion (cdwrd, cdw, cdw&lt;tab&gt;)</span>
<span class="sd">    * venv_ipymagics.py: ipython magics (%cdwrd, cdwrd, cdw)</span>
<span class="sd">    * venv.vim: vim functions  (:Cdwrd)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pathvar</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            pathvar (str): path variable to cd to</span>
<span class="sd">        Keyword Arguments:</span>
<span class="sd">            name (str): alias name (default: ``pathvar.lower.replace(&#39;_&#39;,&#39;&#39;)``)</span>
<span class="sd">                _WRD -&gt; cdwrd, :Cdwrd</span>
<span class="sd">                WORKON_HOME -&gt; workonhome</span>
<span class="sd">            aliases (list[str]): additional alias names (e.g. [&#39;cdw&#39;,])</span>

<span class="sd">        .. py:attribute:: BASH_ALIAS_TEMPLATE</span>

<span class="sd">        .. py:attribute:: BASH_FUNCTION_TEMPLATE</span>

<span class="sd">        .. py:attribute:: BASH_COMPLETION_TEMPLATE</span>

<span class="sd">        .. py:attribute:: VENV_IPYMAGICS_FILE_HEADER</span>

<span class="sd">        .. py:attribute:: VENV_IPYMAGIC_METHOD_TEMPLATE</span>

<span class="sd">        .. py:attribute:: VIM_CD_COMMAND_TEMPLATE</span>

<span class="sd">        .. py:attribute:: VIM_CD_FUNCTION_TEMPLATE</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span> <span class="o">=</span> <span class="n">pathvar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdstr</span> <span class="o">=</span> <span class="s2">&quot;cd </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pathvar</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">aliases</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span>

    <span class="n">VENV_IPYMAGICS_FILE_HEADER</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">#!/usr/bin/env ipython</span>
<span class="sd"># dotfiles.venv.venv_ipymagics</span>
<span class="sd">from __future__ import print_function</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">IPython ``%magic`` commands</span>

<span class="sd">* ``cd`` aliases</span>
<span class="sd">* ``ds`` (``dotfiles_status``)</span>
<span class="sd">* ``dr`` (``dotfiles_reload``)</span>

<span class="sd">Installation</span>
<span class="sd">--------------</span>
<span class="sd">.. code-block:: bash</span>

<span class="sd">    __DOTFILES=&quot;${HOME}/-dotfiles&quot;</span>
<span class="sd">    ipython_profile=&quot;profile_default&quot;</span>
<span class="sd">    ln -s ${__DOTFILES}/etc/ipython/venv_ipymagics.py \\</span>
<span class="sd">        ~/.ipython/${ipython_profile}/startup/venv_ipymagics.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import os</span>
<span class="sd">import sys</span>
<span class="sd">try:</span>
<span class="sd">    from IPython.core.magic import (Magics, magics_class, line_magic)</span>
<span class="sd">except ImportError:</span>
<span class="sd">    print(&quot;ImportError: IPython&quot;)</span>
<span class="sd">    # Mock IPython for building docs</span>
<span class="sd">    Magics = object</span>
<span class="sd">    magics_class = lambda cls, *args, **kwargs: cls</span>
<span class="sd">    line_magic = lambda func, *args, **kwargs: func</span>

<span class="sd">if sys.version_info.major == 2:</span>
<span class="sd">    str = unicode</span>

<span class="sd">def ipymagic_quote(_str):</span>
<span class="sd">    return str(_str)</span>

<span class="sd">@magics_class</span>
<span class="sd">class VenvMagics(Magics):</span>
<span class="sd">    def cd(self, envvar, line):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Change directory</span>

<span class="sd">        Args:</span>
<span class="sd">            envvar (str): os.environ variable name</span>
<span class="sd">            line (str): path to append to envvar</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        prefix = os.environ.get(envvar, &quot;&quot;)</span>
<span class="sd">        _dstpath = line.lstrip(os.path.sep)</span>
<span class="sd">        path = os.path.join(prefix, _dstpath)</span>
<span class="sd">        cmd = (&quot;cd %s&quot; % ipymagic_quote(path))</span>
<span class="sd">        print(&quot;%&quot; + cmd, file=sys.stderr)</span>
<span class="sd">        return self.shell.magic(cmd)&#39;&#39;&#39;</span><span class="p">)</span>

    <span class="n">VENV_IPYMAGIC_METHOD_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    @line_magic</span>
<span class="sd">    def {ipy_func_name}(self, line):</span>
<span class="sd">        &quot;&quot;&quot;{ipy_func_name}    -- cd ${pathvar}/${{@}}&quot;&quot;&quot;</span>
<span class="sd">        return self.cd(&#39;{pathvar}&#39;, line)&#39;&#39;&#39;</span><span class="p">)</span>

    <span class="n">VENV_IPYMAGICS_FOOTER</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    @line_magic</span>
<span class="sd">    def cdhelp(self, line):</span>
<span class="sd">        &quot;&quot;&quot;cdhelp()         -- list cd commands&quot;&quot;&quot;</span>
<span class="sd">        for cdfunc in dir(self):</span>
<span class="sd">            if cdfunc.startswith(&#39;cd&#39;) and cdfunc not in (&#39;cdhelp&#39;,&#39;cd&#39;):</span>
<span class="sd">                docstr = getattr(self, cdfunc).__doc__.split(&#39;--&#39;,1)[-1].strip()</span>
<span class="sd">                print(&quot;%%%-16s -- %s&quot; % (cdfunc, docstr))</span>

<span class="sd">    @staticmethod</span>
<span class="sd">    def _dotfiles_status():</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Print ``dotfiles_status``: venv variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        env_vars = [</span>
<span class="sd">            &#39;HOSTNAME&#39;,</span>
<span class="sd">            &#39;USER&#39;,</span>
<span class="sd">            &#39;PROJECT_HOME&#39;,</span>
<span class="sd">            &#39;CONDA_ROOT&#39;,</span>
<span class="sd">            &#39;CONDA_ENVS_PATH&#39;,</span>
<span class="sd">            &#39;WORKON_HOME&#39;,</span>
<span class="sd">            &#39;VIRTUAL_ENV_NAME&#39;,</span>
<span class="sd">            &#39;VIRTUAL_ENV&#39;,</span>
<span class="sd">            &#39;_USRLOG&#39;,</span>
<span class="sd">            &#39;_TERM_ID&#39;,</span>
<span class="sd">            &#39;_SRC&#39;,</span>
<span class="sd">            &#39;_APP&#39;,</span>
<span class="sd">            &#39;_WRD&#39;,</span>
<span class="sd">            &#39;PATH&#39;,</span>
<span class="sd">            &#39;__DOTFILES&#39;,</span>
<span class="sd">        ]</span>
<span class="sd">        environ = dict((var, os.environ.get(var)) for var in env_vars)</span>
<span class="sd">        environ[&#39;HOSTNAME&#39;] = __import__(&#39;socket&#39;).gethostname()</span>
<span class="sd">        for var in env_vars:</span>
<span class="sd">            print(&#39;{}=&quot;{}&quot;&#39;.format(var, &quot;%s&quot; % environ.get(var,&#39;&#39;)))</span>

<span class="sd">    @line_magic</span>
<span class="sd">    def dotfiles_status(self, line):</span>
<span class="sd">        &quot;&quot;&quot;dotfiles_status()    -- print dotfiles_status() .&quot;&quot;&quot;</span>
<span class="sd">        return self._dotfiles_status()</span>

<span class="sd">    @line_magic</span>
<span class="sd">    def ds(self, line):</span>
<span class="sd">        &quot;&quot;&quot;ds()                 -- print dotfiles_status() .&quot;&quot;&quot;</span>
<span class="sd">        return self._dotfiles_status()</span>

<span class="sd">    @staticmethod</span>
<span class="sd">    def _dotfiles_reload():</span>
<span class="sd">        &quot;&quot;&quot;_dotfiles_reload()   -- print NotImplemented&quot;&quot;&quot;</span>
<span class="sd">        print(&quot;NotImplemented: dotfiles_reload()&quot;)</span>

<span class="sd">    @line_magic</span>
<span class="sd">    def dotfiles_reload(self, line):</span>
<span class="sd">        &quot;&quot;&quot;dotfiles_reload()    -- print NotImplemented&quot;&quot;&quot;</span>
<span class="sd">        return self._dotfiles_reload()</span>

<span class="sd">    @line_magic</span>
<span class="sd">    def dr(self, line):</span>
<span class="sd">        &quot;&quot;&quot;dr()                 -- print NotImplemented [dotfiles_reload()]&quot;&quot;&quot;</span>
<span class="sd">        return self._dotfiles_reload()</span>


<span class="sd">def main():</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    Register VenvMagics with IPython</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    import IPython</span>
<span class="sd">    ip = IPython.get_ipython()</span>
<span class="sd">    ip.register_magics(VenvMagics)</span>


<span class="sd">if __name__ == &quot;__main__&quot;:</span>
<span class="sd">    main()</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CdAlias.to_ipython_method"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CdAlias.to_ipython_method">[docs]</a>    <span class="k">def</span> <span class="nf">to_ipython_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keyword Arguments:</span>
<span class="sd">            include_completions (bool): generate inline Bash completions</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: ipython method block</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">cmd_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bash_func_names</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">VENV_IPYMAGIC_METHOD_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">pathvar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span><span class="p">,</span>
                <span class="n">ipy_func_name</span><span class="o">=</span><span class="n">cmd_name</span><span class="p">))</span></div>

    <span class="n">VIM_HEADER_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot; ### venv.vim\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot; # Src: https://github.com/westurner/venv.vim\n\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot; &quot;g:venv_list_only_dirs -- 1 -- 0 to list files in Cd* commands\n\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;let g:venv_list_only_dirs = 1\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! Cd_help()\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot; :Cdhelp             -- list venv.vim cdalias commands\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    :verbose command Cd\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;command! -nargs=0 Cdhelp call Cd_help()\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! ListDirsOrFiles(path, ArgLead, ...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let dirsonly = ((a:0&gt;0) ? 1 : g:venv_list_only_dirs)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let _glob = &#39;&#39; . a:ArgLead . ((g:venv_list_only_dirs&gt;1) ? &#39;*/&#39; : &#39;*&#39;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    execute &#39;lcd&#39; a:path\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    if dirsonly ==? 1\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;        let output = map(sort(globpath(&#39;.&#39;, _glob, 0, 1), &#39;i&#39;), &#39;v:val[2:]&#39;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    elseif dirsonly ==? 0\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;        let output = map(sort(globpath(&#39;.&#39;, _glob, 0, 1), &#39;i&#39;), &#39;v:val[2:] . (isdirectory(v:val) ? &quot;/&quot; : &quot;&quot;)&#39;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    endif\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    execute &#39;lcd -&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    return output\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! Cdhere(...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot;   :Cdhere  --  cd to here (this dir, dirname(__file__))    [cd %:p:h]\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot;   :CDhere  --  cd to here (this dir, dirname(__file__))    [cd %:p:h]\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let _path = expand(&#39;%:p:h&#39;) . ((a:0&gt;0) ? (&#39;/&#39; . a:1) : &#39;&#39;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    execute &#39;cd&#39; _path\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    pwd\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! Compl_Cdhere(ArgLead, ...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    return ListDirsOrFiles(expand(&#39;%:p:h&#39;), a:ArgLead, 1)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfor\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;command! -nargs=* -complete=customlist,Compl_Cdhere Cdhere call Cdhere(&lt;f-args&gt;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;command! -nargs=* -complete=customlist,Compl_Cdhere CDhere call Cdhere(&lt;f-args&gt;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! Lcdhere(...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot;   :Lcdhere -- lcd to here (this dir, dirname(__file__))  [lcd %:p:h]\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot;   :LCdhere -- lcd to here (this dir, dirname(__file__))  [lcd %:p:h]\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let _path = expand(&#39;%:p:h&#39;) . ((a:0&gt;0) ? (&#39;/&#39; . a:1) : &#39;&#39;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    execute &#39;lcd&#39; _path\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    pwd\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;command! -nargs=* -complete=customlist,Compl_Cdhere Lcdhere call Lcdhere(&lt;f-args&gt;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;command! -nargs=* -complete=customlist,Compl_Cdhere LCdhere call Lcdhere(&lt;f-args&gt;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>

        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! Cd___VAR_(varname, cmd, ...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot; Cd___VAR_()  -- cd expand(&#39;$&#39; . a:varname)/$1\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let _VARNAME = a:varname\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let _VAR_=expand(_VARNAME)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    if _VARNAME ==? _VAR_\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;        echoerr _VARNAME . &quot; is not set&quot;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;        return\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    endif\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let pathname = join([_VAR_, (a:0&gt;0) ? a:1 : &quot;&quot;], &quot;/&quot;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    execute a:cmd pathname\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    pwd\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
    <span class="p">)</span>

    <span class="n">VIM_CD_FUNCTION_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! {vim_func_name}(...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot; {vim_func_name}()  -- cd ${pathvar}/$1\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    call Cd___VAR_(&#39;${pathvar}&#39;, &#39;{vim_cd_func}&#39;, (a:0&gt;0)? a:1 : &quot;&quot;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! Compl_{vim_func_name}(ArgLead, ...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    return ListDirsOrFiles(${pathvar}, a:ArgLead, 1)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
    <span class="p">)</span>
    <span class="n">VIM_CD_COMMAND_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;&quot;   :{cmd_name:&lt;10} -- cd ${pathvar}/$1\n&#39;&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;command! -nargs=* -complete=customlist,Compl_{vim_func_name} {cmd_name} call {vim_func_name}(&lt;f-args&gt;)\n&quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="n">VIM_EDIT_FUNCTION_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! {vim_func_name}(...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;&quot; {vim_func_name}()  -- e ${pathvar}/$1\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    let _path=expand(&quot;${pathvar}&quot;) . ((a:0&gt;0)? &quot;/&quot; . a:1 : &quot;&quot;)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    execute &#39;{vim_edit_func}&#39; _path\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;function! Compl_{vim_func_name}(ArgLead, ...)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;    return ListDirsOrFiles(${pathvar}, a:ArgLead, 0)\n&#39;&#39;&#39;</span>
        <span class="sd">&#39;&#39;&#39;endfunction\n&#39;&#39;&#39;</span>
    <span class="p">)</span>
    <span class="n">VIM_EDIT_COMMAND_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;&quot;   :{cmd_name:&lt;10} -- e ${pathvar}/$1\n&#39;&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;command! -nargs=* -complete=customlist,Compl_{vim_func_name} {cmd_name} call {vim_func_name}(&lt;f-args&gt;)\n&quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vim_cmd_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: e.g &quot;Cdwrd&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Cd</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vim_cmd_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: self.vim_cmd_name + self.aliases.title()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vim_cmd_name</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span>
                <span class="p">[</span><span class="n">alias</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span>
                 <span class="k">if</span> <span class="ow">not</span> <span class="n">alias</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<div class="viewcode-block" id="CdAlias.to_vim_function"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CdAlias.to_vim_function">[docs]</a>    <span class="k">def</span> <span class="nf">to_vim_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: vim function block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># cdalias commands</span>
        <span class="n">confs</span> <span class="o">=</span> <span class="n">cdalias_confs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;pathvar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_func_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Cd_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vim_cmd_name</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vim_cmd_names</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cd_func&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cd&#39;</span>
        <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">conf2</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">conf2</span><span class="p">[</span><span class="s1">&#39;vim_func_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;L&quot;</span> <span class="o">+</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_func_name&#39;</span><span class="p">]</span>
        <span class="n">conf2</span><span class="p">[</span><span class="s1">&#39;vim_cmd_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;L&quot;</span> <span class="o">+</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_name&#39;</span><span class="p">]</span>
        <span class="n">conf2</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]]</span>
        <span class="n">conf2</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;L</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]]</span>
        <span class="n">conf2</span><span class="p">[</span><span class="s1">&#39;vim_cd_func&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lcd&#39;</span>
        <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf2</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">confs</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">VIM_CD_FUNCTION_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">cmd_name</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">VIM_CD_COMMAND_TEMPLATE</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd_name</span><span class="o">=</span><span class="n">cmd_name</span><span class="p">,</span>
                                        <span class="n">pathvar</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;pathvar&#39;</span><span class="p">],</span>
                                        <span class="n">vim_func_name</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_func_name&#39;</span><span class="p">]),)</span>
        <span class="c1"># edit_commands</span>
        <span class="n">edit_cmd_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]])</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">confs</span> <span class="o">=</span> <span class="n">edit_cmd_confs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">conf3</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">conf3</span><span class="p">[</span><span class="s1">&#39;vim_func_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;E&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="n">conf3</span><span class="p">[</span><span class="s1">&#39;vim_cmd_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;E&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="n">conf3</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;E</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edit_cmd_names</span><span class="p">]</span>
        <span class="c1"># conf3[&#39;vim_cmd_names&#39;] += [&quot;E{}&quot;.format(x).title() for x in edit_cmd_names]</span>
        <span class="n">conf3</span><span class="p">[</span><span class="s1">&#39;vim_edit_func&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;e&#39;</span>
        <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf3</span><span class="p">)</span>
        <span class="n">conf4</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">conf4</span><span class="p">[</span><span class="s1">&#39;vim_func_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tabnew&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="n">conf4</span><span class="p">[</span><span class="s1">&#39;vim_cmd_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tabnew&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="n">conf4</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Tabnew</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">edit_cmd_names</span><span class="p">]</span>
        <span class="c1"># conf4[&#39;vim_cmd_names&#39;] += [&quot;Tabnew{}&quot;.format(x).title() for x in edit_cmd_names]</span>
        <span class="n">conf4</span><span class="p">[</span><span class="s1">&#39;vim_edit_func&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tabnew&#39;</span>
        <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">confs</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">VIM_EDIT_FUNCTION_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">cmd_name</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_cmd_names&#39;</span><span class="p">]:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">VIM_EDIT_COMMAND_TEMPLATE</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd_name</span><span class="o">=</span><span class="n">cmd_name</span><span class="p">,</span>
                                        <span class="n">pathvar</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;pathvar&#39;</span><span class="p">],</span>
                                        <span class="n">vim_func_name</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;vim_func_name&#39;</span><span class="p">]),)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;\n&#39;&#39;&#39;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>

    <span class="n">BASH_CDALIAS_HEADER</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;#!/bin/sh\n&#39;&#39;&#39;</span>
        <span class="sd">&quot;&quot;&quot;## venv.sh\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;# generated from $(venv --print-bash --prefix=/)\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">BASH_FUNCTION_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;{bash_func_name} () {{\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;    # {bash_func_name:16}  -- cd ${pathvar} /$@\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;    [ -z &quot;${pathvar}&quot; ] &amp;&amp; echo &quot;{pathvar} is not set&quot; &amp;&amp; return 1\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;    cd &quot;${pathvar}&quot;${{@:+&quot;/${{@}}&quot;}}\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;}}\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;{bash_compl_name} () {{\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;    local cur=&quot;$2&quot;;\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;    COMPREPLY=($({bash_func_name} &amp;&amp; compgen -d -- &quot;${{cur}}&quot; ))\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;}}\n&quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">BASH_ALIAS_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;{cmd_name} () {{\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;    # {cmd_name:16}  -- cd ${pathvar}\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;    {bash_func_name} $@\n&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;}}\n&quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">BASH_COMPLETION_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sd">&quot;&quot;&quot;complete -o default -o nospace -F {bash_compl_name} {cmd_name}\n&quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bash_func_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: e.g. &quot;cdwrd&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;cd</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bash_func_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: self.bash_func_name + self.aliases</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bash_func_name</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span>

<div class="viewcode-block" id="CdAlias.to_bash_function"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CdAlias.to_bash_function">[docs]</a>    <span class="k">def</span> <span class="nf">to_bash_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_completions</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keyword Arguments:</span>
<span class="sd">            include_completions (bool): generate inline Bash completions</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: bash function block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;pathvar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;bash_func_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bash_func_name</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;bash_func_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bash_func_names</span>
        <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;bash_compl_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_cd_</span><span class="si">%s</span><span class="s2">_complete&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathvar</span>

        <span class="k">def</span> <span class="nf">_iter_bash_function</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">BASH_FUNCTION_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">cmd_name</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;bash_func_names&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">BASH_ALIAS_TEMPLATE</span>
                       <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd_name</span><span class="o">=</span><span class="n">cmd_name</span><span class="p">,</span>
                               <span class="n">pathvar</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;pathvar&#39;</span><span class="p">],</span>
                               <span class="n">bash_func_name</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;bash_func_name&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">include_completions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cmd_name</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;bash_func_names&#39;</span><span class="p">]:</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">CdAlias</span><span class="o">.</span><span class="n">BASH_COMPLETION_TEMPLATE</span>
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd_name</span><span class="o">=</span><span class="n">cmd_name</span><span class="p">,</span>
                                   <span class="n">bash_compl_name</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;bash_compl_name&#39;</span><span class="p">]))</span>

        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_iter_bash_function</span><span class="p">(</span><span class="n">conf</span><span class="p">))</span></div>

    <span class="c1"># def to_shell_str(self):</span>
    <span class="c1">#    return &#39;cd {}/%l&#39;.format(shell_varquote(self.PATH_VARIABLE))</span>
<div class="viewcode-block" id="CdAlias.to_shell_str"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.CdAlias.to_shell_str">[docs]</a>    <span class="k">def</span> <span class="nf">to_shell_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: eval \&#39;{_to_bash_function()}\&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;eval </span><span class="se">\&#39;\n</span><span class="si">{cmdstr}</span><span class="se">\n\&#39;</span><span class="s2">;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">cmdstr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">to_bash_function</span><span class="p">())</span></div>

    <span class="fm">__str__</span> <span class="o">=</span> <span class="n">to_shell_str</span></div>


<span class="c1">#######################################</span>
<span class="c1"># def build_*_env(env=None, **kwargs):</span>
<span class="c1">#    return env</span>
<span class="c1">#######################################</span>

<div class="viewcode-block" id="Step"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Step">[docs]</a><span class="k">class</span> <span class="nc">Step</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A build task step which builds or transforms an</span>
<span class="sd">    :py:mod:`Env`, by calling ``step.build(env=env, **step.conf)``</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keyword Arguments:</span>
<span class="sd">            func (callable): ``function(env=None, **kwargs)``</span>
<span class="sd">            name (str): a name for the step</span>
<span class="sd">            conf (dict): a configuration dict (instead of kwargs) for this step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">func</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FUNC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="n">func</span>
        <span class="c1"># remove env from the conf dict # XXX</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># conf = kwargs if conf=None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;conf&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: a name for this Step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">namestr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">namestr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">namestr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">namestr</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">__set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;step name=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;step name=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields:</span>
<span class="sd">            tuple: (&#39;attrname&#39;, obj)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;conf&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span>

<div class="viewcode-block" id="Step.asdict"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Step.asdict">[docs]</a>    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            OrderedDict: OrderedDict(self._iteritems())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iteritems</span><span class="p">())</span></div>

<div class="viewcode-block" id="Step.build_print_kwargs_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Step.build_print_kwargs_env">[docs]</a>    <span class="k">def</span> <span class="nf">build_print_kwargs_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default ``build_*_env`` Step.func function to print ``env``</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            env (:py:mod:`Env`): Env object (default: None)</span>
<span class="sd">            kwargs (dict): kwargs dict</span>

<span class="sd">        Returns:</span>
<span class="sd">            :py:mod:`Env`: updated Env</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Note: StepBuilder also does env.copy before each step</span>
            <span class="c1"># making this unnecessary for many build_*_env functions</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;build_print_kwargs_env&#39;</span><span class="p">,</span> <span class="n">comment_comment</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span></div>

    <span class="n">DEFAULT_FUNC</span> <span class="o">=</span> <span class="n">build_print_kwargs_env</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">DEFAULT_FUNC</span>

<div class="viewcode-block" id="Step.build"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Step.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call ``self.func(env=env, **self.conf.copy().update(**kwargs))``</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            env (Env): Env object (default: None)</span>
<span class="sd">            kwargs (dict): kwargs dict</span>
<span class="sd">        Returns:</span>
<span class="sd">            obj: ``self.func(env=env, **self.conf.copy().update(**kwargs))``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># TODO: verbose merge</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="o">**</span><span class="n">conf</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PrintEnvStep"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.PrintEnvStep">[docs]</a><span class="k">class</span> <span class="nc">PrintEnvStep</span><span class="p">(</span><span class="n">Step</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print env and kwargs to stdout</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;print_env&#39;</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">Step</span><span class="o">.</span><span class="n">build_print_kwargs_env</span></div>


<div class="viewcode-block" id="PrintEnvStderrStep"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.PrintEnvStderrStep">[docs]</a><span class="k">class</span> <span class="nc">PrintEnvStderrStep</span><span class="p">(</span><span class="n">PrintEnvStep</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print env and kwargs to stderr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;print_env_stderr&#39;</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span></div>


<div class="viewcode-block" id="StepBuilder"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.StepBuilder">[docs]</a><span class="k">class</span> <span class="nc">StepBuilder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for building a sequence of steps which modify env</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># conf=None, steps=None, show_diffs=False, debug=False</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keyword Argumentss:</span>
<span class="sd">            conf (dict): initial configuration dict</span>
<span class="sd">                show_diffs and debug overwrite</span>
<span class="sd">            steps (list): initial list of Step() instances (default: None)</span>
<span class="sd">            show_diffs (bool): show diffs of Envs between steps</span>
<span class="sd">            debug (bool): show debugging output</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;conf&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="s2">&quot;show_diffs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;show_diffs&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_diffs&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">))</span>
        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;StepBuilder </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;__init__&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_name&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: self.conf.get(&#39;debug&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">show_diffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: self.conf.get(&#39;show_diffs&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_diffs&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="StepBuilder.add_step"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.StepBuilder.add_step">[docs]</a>    <span class="k">def</span> <span class="nf">add_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a step to ``self.steps``</span>

<span class="sd">        Args:</span>
<span class="sd">            func (Step or function or str): ``func(env=None, **kwargs)``</span>
<span class="sd">            kwargs (dict): kwargs for Step.conf</span>
<span class="sd">        Keyword Arguments:</span>
<span class="sd">            name (str): function name (default: None)</span>
<span class="sd">        Returns:</span>
<span class="sd">            :py:mod:`Step`: Step object appended to self.steps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Step</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">STR_TYPES</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">PrintEnvStep</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">func</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">Step</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">conf</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">StepConfigException</span><span class="p">({</span>
                <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="n">func</span><span class="p">,</span>
                <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="s1">&#39;func must be a (Step, STR_TYPES, callable)&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">step</span></div>

<div class="viewcode-block" id="StepBuilder.build_iter"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.StepBuilder.build_iter">[docs]</a>    <span class="k">def</span> <span class="nf">build_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_diffs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a generator of (Step, Env) tuples from the</span>
<span class="sd">        functional composition of StepBuilder.steps</span>
<span class="sd">        given an initial :py:mod:`Env` (or None).</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            # pseudocode</span>
<span class="sd">            env_previous = Env()</span>
<span class="sd">            for step in self.steps:</span>
<span class="sd">                (step, env) = step.build(env=env_previous.copy(),**conf)</span>
<span class="sd">                env_previous=env</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            env (Env): initial Env (default: None)</span>
<span class="sd">            show_diffs (bool): show difflib.ndiffs of Envs between steps</span>
<span class="sd">            debug (bool):</span>
<span class="sd">        Yields:</span>
<span class="sd">            tuple: (:py:mod:`Step`, :py:mod:`Env`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">env</span><span class="p">:</span>
            <span class="n">env0</span> <span class="o">=</span> <span class="n">env</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">env0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

        <span class="k">yield</span> <span class="p">(</span><span class="n">PrintEnvStep</span><span class="p">(</span><span class="s1">&#39;env0&#39;</span><span class="p">),</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="c1"># log = global log</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
            <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;BLD </span><span class="si">%s</span><span class="s1"> build </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                     <span class="n">str_center</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">),)</span>
            <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> build.conf&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> step.conf &#39;</span> <span class="o">%</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &gt;&gt;&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">env</span><span class="p">))),</span>
                     <span class="n">env</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">step</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span>

            <span class="n">new_env</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="o">**</span><span class="n">conf</span><span class="p">)</span>
            <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &gt;&gt;&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">new_env</span><span class="p">))),</span>
                     <span class="n">new_env</span><span class="p">,</span>
                     <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_env</span><span class="p">,</span> <span class="n">Env</span><span class="p">):</span>
                <span class="c1"># logevent(&#39;%s new_env&#39; % step.name, new_env, wrap=True)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_diffs</span> <span class="ow">and</span> <span class="n">env</span><span class="p">:</span>
                    <span class="n">diff_output</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">new_env</span><span class="p">)</span>
                    <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &lt;diff&gt;&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">diff_output</span><span class="p">:</span>
                        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;diff&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
                    <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &lt;/diff&gt;&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">new_env</span><span class="p">)</span>
                <span class="n">env</span> <span class="o">=</span> <span class="n">new_env</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logevent</span><span class="p">(</span><span class="s2">&quot;# </span><span class="si">%r</span><span class="s2"> returned </span><span class="si">%r</span><span class="s2"> which is not an Env&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_env</span><span class="p">))</span>
            <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> stepdict&#39;</span> <span class="o">%</span> <span class="n">step</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="StepBuilder.build"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.StepBuilder.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a list of Envs from ``self.build_iter(*args, **kwargs)``</span>
<span class="sd">        and return the last Env.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            debug (bool): log.debug(env)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Env or None: the last env returned from ``.build_iter``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
        <span class="n">step_envs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;BLD </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">env</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_iter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">step_envs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step_envs</span><span class="p">:</span>
            <span class="n">return_env</span> <span class="o">=</span> <span class="n">step_envs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_env</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;BLD </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;build-out&#39;</span><span class="p">),</span>
                 <span class="n">env</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">return_env</span><span class="p">,</span> <span class="s1">&#39;to_json&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">return_env</span><span class="p">,</span>
                 <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">return_env</span></div></div>
        <span class="c1"># return step_envs</span>



<div class="viewcode-block" id="lookup_from_kwargs_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.lookup_from_kwargs_env">[docs]</a><span class="k">def</span> <span class="nf">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    __getitem__ from kwargs, env, or default.</span>

<span class="sd">    Args:</span>
<span class="sd">        kwargs (dict): kwargs dict</span>
<span class="sd">        env (Env): :py:mod:`Env` dict</span>
<span class="sd">        attr (str): attribute name</span>
<span class="sd">        default (obj): default value to return if not found in kwargs or env</span>
<span class="sd">    Returns:</span>
<span class="sd">        obj: kwargs.get(attr, env.get(attr, default))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="p">))</span></div>


<div class="viewcode-block" id="build_dotfiles_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_dotfiles_env">[docs]</a><span class="k">def</span> <span class="nf">build_dotfiles_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure dotfiles base environment (HOME, __WRK, __SRC, __DOTFILES)</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">        HOME (str): home path (``$HOME``, ``~``)</span>
<span class="sd">        __WRK (str): workspace path (``$__WRK``, ``~/-wrk``)</span>
<span class="sd">        __SRC (str): path to source repos (``$__WRK/-src``)</span>
<span class="sd">        __DOTFILES (str): current dotfiles path (``~/-dotfiles``)</span>

<span class="sd">    Returns:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>

<span class="sd">        Sets:</span>

<span class="sd">        * HOME</span>
<span class="sd">        * __WRK</span>
<span class="sd">        * __SRC</span>
<span class="sd">        * __DOTFILES</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span>  <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">))</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="p">))</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__SRC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;__SRC&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="s1">&#39;-src&#39;</span><span class="p">))</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__DOTFILES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;__DOTFILES&#39;</span><span class="p">,</span>
                               <span class="n">default</span><span class="o">=</span><span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;-dotfiles&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">env</span></div>


<span class="c1"># DEFAULT_WORKON_HOME_DEFAULT (str): variable holding path to WORKON_HOME</span>
<span class="n">DEFAULT_WORKON_HOME_DEFAULT</span> <span class="o">=</span> <span class="s2">&quot;WORKON_HOME__py27&quot;</span>


<div class="viewcode-block" id="build_virtualenvwrapper_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_virtualenvwrapper_env">[docs]</a><span class="k">def</span> <span class="nf">build_virtualenvwrapper_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set WORKON_HOME to WORKON_HOME or WORKON_HOME_DEFAULT</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">        __WRK (str): workspace path (``$__WRK``, ``~/-wrk``)</span>
<span class="sd">        WORKON_HOME_DEFAULT (str): variable name (default: ``WORKON_HOME__py27``)</span>
<span class="sd">        WORKON_HOME__* (str): path to a WORKON_HOME set</span>
<span class="sd">    Returns:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>

<span class="sd">        Sets:</span>

<span class="sd">        * WORKON_HOME__py27=&#39;${__WRK}/-ve27&#39;</span>
<span class="sd">        * WORKON_HOME__py34=&#39;${__WRK}/-ve34&#39;</span>
<span class="sd">        * WORKON_HOME__*=kwargs.get(WORKON_HOME__*)</span>
<span class="sd">        * WORKON_HOME_DEFAULT=&#39;WORKON_HOME_py27&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">))</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PROJECT_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;PROJECT_HOME&#39;</span><span class="p">,</span>
                                 <span class="n">default</span><span class="o">=</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">])</span>      <span class="c1"># cdprojecthome cdph</span>

    <span class="c1">#env[&#39;PYTHON27_ROOT&#39;] = joinpath(env[&#39;__WRK&#39;], &#39;-python27&#39;)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME__py27&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME__py27&#39;</span><span class="p">,</span>
                                      <span class="n">default</span><span class="o">=</span><span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="s1">&#39;-ve27&#39;</span><span class="p">))</span>
    <span class="c1">#env[&#39;PYTHON34_ROOT&#39;] = joinpath(env[&#39;__WRK&#39;], &#39;-python34&#39;)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME__py34&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME__py34&#39;</span><span class="p">,</span>
                                      <span class="n">default</span><span class="o">=</span><span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="s1">&#39;-ve34&#39;</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;WORKON_HOME__&quot;</span><span class="p">):</span>
            <span class="n">env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME_DEFAULT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME_DEFAULT&#39;</span><span class="p">,</span>
                                        <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_WORKON_HOME_DEFAULT</span><span class="p">)</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>
                                <span class="n">default</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME_DEFAULT&#39;</span><span class="p">)))</span>
    <span class="c1"># cdworkonhome  cdwh</span>
    <span class="k">return</span> <span class="n">env</span></div>


<div class="viewcode-block" id="build_conda_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_conda_env">[docs]</a><span class="k">def</span> <span class="nf">build_conda_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure conda27 (2.7) and conda (3.4)</span>
<span class="sd">    with condaenvs in ``-wrk/-ce27`` and ``-wrk/ce34``.</span>

<span class="sd">    Other Parameters:</span>
<span class="sd">        __WRK (str): workspace root (``$__WRK``, ``~/-wrk``)</span>
<span class="sd">        CONDA_ROOT__py27 (str): path to conda27 root environment</span>
<span class="sd">        CONDA_ENVS__py27 (str): path to conda27 envs (e.g. WORKON_HOME)</span>
<span class="sd">        CONDA_ROOT__py34 (str): path to conda34 root environment</span>
<span class="sd">        CONDA_ENVS__py34 (str): path to conda34 envs (e.g. WORKON_HOME)</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">    Returns:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">))</span>

    <span class="c1"># get default env paths</span>
    <span class="n">confs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;__py&quot;</span><span class="p">,</span>
            <span class="n">env_suffix</span><span class="o">=</span><span class="s2">&quot;27&quot;</span><span class="p">,</span>
            <span class="n">env_root_prefix</span><span class="o">=</span><span class="s2">&quot;-conda&quot;</span><span class="p">,</span>
            <span class="n">env_home_prefix</span><span class="o">=</span><span class="s2">&quot;-ce&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;__py&quot;</span><span class="p">,</span>
            <span class="n">env_suffix</span><span class="o">=</span><span class="s2">&quot;34&quot;</span><span class="p">,</span>
            <span class="n">env_root_prefix</span><span class="o">=</span><span class="s2">&quot;-conda&quot;</span><span class="p">,</span>
            <span class="n">env_home_prefix</span><span class="o">=</span><span class="s2">&quot;-ce&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;__py&quot;</span><span class="p">,</span>
            <span class="n">env_suffix</span><span class="o">=</span><span class="s2">&quot;35&quot;</span><span class="p">,</span>
            <span class="n">env_root_prefix</span><span class="o">=</span><span class="s2">&quot;-conda&quot;</span><span class="p">,</span>
            <span class="n">env_home_prefix</span><span class="o">=</span><span class="s2">&quot;-ce&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;__py&quot;</span><span class="p">,</span>
            <span class="n">env_suffix</span><span class="o">=</span><span class="s2">&quot;36&quot;</span><span class="p">,</span>
            <span class="n">env_root_prefix</span><span class="o">=</span><span class="s2">&quot;-conda&quot;</span><span class="p">,</span>
            <span class="n">env_home_prefix</span><span class="o">=</span><span class="s2">&quot;-ce&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;__py&quot;</span><span class="p">,</span>
            <span class="n">env_suffix</span><span class="o">=</span><span class="s2">&quot;37&quot;</span><span class="p">,</span>
            <span class="n">env_root_prefix</span><span class="o">=</span><span class="s2">&quot;-conda&quot;</span><span class="p">,</span>
            <span class="n">env_home_prefix</span><span class="o">=</span><span class="s2">&quot;-ce&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">confs</span><span class="p">:</span>
        <span class="c1"># CONDA27</span>
        <span class="n">env_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{env_prefix}{env_suffix}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">)</span>
        <span class="c1"># -conda27</span>
        <span class="n">env_root</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{env_root_prefix}{env_suffix}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">)</span>
        <span class="c1"># -ce27</span>
        <span class="n">env_home</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{env_home_prefix}{env_suffix}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">)</span>

        <span class="n">root_key</span> <span class="o">=</span> <span class="s2">&quot;CONDA_ROOT</span><span class="si">{env_name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env_name</span><span class="o">=</span><span class="n">env_name</span><span class="p">)</span>
        <span class="n">home_key</span> <span class="o">=</span> <span class="s2">&quot;CONDA_ENVS</span><span class="si">{env_name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env_name</span><span class="o">=</span><span class="n">env_name</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="n">root_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">root_key</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">root_key</span><span class="p">))</span> <span class="ow">or</span>
                         <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="n">env_root</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="n">home_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">home_key</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">home_key</span><span class="p">))</span> <span class="ow">or</span>
                         <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="n">env_home</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">env</span></div>


<span class="n">DEFAULT_CONDA_ROOT_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;CONDA_ROOT__py37&#39;</span>
<span class="n">DEFAULT_CONDA_ENVS_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;CONDA_ENVS__py37&#39;</span>


<div class="viewcode-block" id="build_conda_cfg_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_conda_cfg_env">[docs]</a><span class="k">def</span> <span class="nf">build_conda_cfg_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure conda for a specific environment</span>
<span class="sd">    TODO build_venv_config</span>

<span class="sd">    Args:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">    Returns:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">))</span>

    <span class="n">conda_envs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">conda_envs</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;CONDA_ROOT__py</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;CONDA_ROOT__py</span><span class="si">%s</span><span class="s1"> % n&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="s1">&#39;-conda</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;CONDA_ENVS__py</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;CONDA_ENVS__py</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">],</span> <span class="s1">&#39;-ce</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)))</span>
    <span class="c1"># env[&#39;CONDA_ROOT__py27&#39;] = lookup(&#39;CONDA_ROOT__py27&#39;,</span>
    <span class="c1">#                                  default=joinpath(env[&#39;__WRK&#39;], &#39;-conda27&#39;))</span>
    <span class="c1"># env[&#39;CONDA_ENVS__py27&#39;] = lookup(&#39;CONDA_ENVS__py27&#39;,</span>
    <span class="c1">#                                  default=joinpath(env[&#39;__WRK&#39;], &#39;-ce27&#39;))</span>


    <span class="c1">#env[&#39;CONDA_ROOT_DEFAULT&#39;] = lookup(&#39;CONDA_ROOT_DEFAULT&#39;,</span>
    <span class="c1">#                                   default=DEFAULT_CONDA_ROOT_DEFAULT)</span>
    <span class="c1">#env[&#39;CONDA_ENVS_DEFAULT&#39;] = lookup(&#39;CONDA_ENVS_DEFAULT&#39;,</span>
    <span class="c1">#                                   default=DEFAULT_CONDA_ENVS_DEFAULT)</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;CONDA_ROOT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;CONDA_ROOT&#39;</span><span class="p">,</span>
                               <span class="n">default</span><span class="o">=</span><span class="n">env</span><span class="p">[</span><span class="n">DEFAULT_CONDA_ROOT_DEFAULT</span><span class="p">])</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;CONDA_ENVS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;CONDA_ENVS_PATH&#39;</span><span class="p">,</span>
                               <span class="n">default</span><span class="o">=</span><span class="n">env</span><span class="p">[</span><span class="n">DEFAULT_CONDA_ENVS_DEFAULT</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">env</span></div>


<div class="viewcode-block" id="build_venv_paths_full_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_venv_paths_full_env">[docs]</a><span class="k">def</span> <span class="nf">build_venv_paths_full_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">pyver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set variables for standard paths in the environment</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env` (default: None (Env()))</span>
<span class="sd">        VENVPREFIX (str): venv prefix path (default: None (VIRTUAL_ENV))</span>
<span class="sd">        VENVSTR (str): name of a VIRTUAL_ENV in WORKON_HOME or path to a VIRTUAL_ENV (default: None)</span>
<span class="sd">        VIRTUAL_ENV (str): path to a VIRTUAL_ENV (default: None)</span>
<span class="sd">    Returns:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">    Raises:</span>
<span class="sd">        StepConfigException: When not any((</span>
<span class="sd">            VIRTUAL_ENV, VENVPREFIX, VENVSTR, VENVSTRAPP))</span>

<span class="sd">    References:</span>
<span class="sd">        - https://en.wikipedia.org/wiki/Unix_directory_structure</span>
<span class="sd">        - https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pyver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pyver</span> <span class="o">=</span> <span class="n">get_pyver</span><span class="p">(</span><span class="n">pyver</span><span class="p">)</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">))</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">Venv</span><span class="o">.</span><span class="n">parse_VENVSTR</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
                                <span class="n">pyver</span><span class="o">=</span><span class="n">pyver</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>
    <span class="n">VENVPREFIX</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">VENVPREFIX</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">VIRTUAL_ENV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">VENVPREFIX</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="s1">&#39;VENVPREFIX or VIRTUAL_ENV must be specified&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;env&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                 <span class="c1">#&#39;envstr&#39;: str(env),</span>
                 <span class="p">})</span>
            <span class="k">raise</span> <span class="n">StepConfigException</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_BIN&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>            <span class="c1"># ./bin</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;etc&quot;</span><span class="p">)</span>            <span class="c1"># ./etc</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETCOPT&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;etc&quot;</span><span class="p">,</span> <span class="s2">&quot;opt&quot;</span><span class="p">)</span>     <span class="c1"># ./etc/opt</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_HOME&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;home&quot;</span><span class="p">)</span>           <span class="c1"># ./home</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_LIB&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">)</span>            <span class="c1"># ./lib</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_PYLIB&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span>       <span class="c1"># ./lib/pythonN.N</span>
                                 <span class="n">pyver</span><span class="p">)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_PYSITE&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span>  <span class="c1"># ./lib/pythonN.N/site-packages</span>
                                  <span class="s2">&quot;lib&quot;</span><span class="p">,</span>
                                  <span class="n">pyver</span><span class="p">,</span> <span class="s1">&#39;site-packages&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_MNT&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;mnt&quot;</span><span class="p">)</span>            <span class="c1"># ./mnt</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_MEDIA&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;media&quot;</span><span class="p">)</span>          <span class="c1"># ./media</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_OPT&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;opt&quot;</span><span class="p">)</span>            <span class="c1"># ./opt</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ROOT&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;root&quot;</span><span class="p">)</span>           <span class="c1"># ./root</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SBIN&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;sbin&quot;</span><span class="p">)</span>           <span class="c1"># ./sbin</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">)</span>            <span class="c1"># ./src</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRV&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;srv&quot;</span><span class="p">)</span>            <span class="c1"># ./srv</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_TMP&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>            <span class="c1"># ./tmp</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USR&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">)</span>            <span class="c1"># ./usr</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRBIN&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>      <span class="c1"># ./usr/bin</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRINCLUDE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;include&quot;</span><span class="p">)</span>  <span class="c1"># ./usr/include</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRLIB&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">)</span>      <span class="c1"># ./usr/lib</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRLOCAL&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">)</span>    <span class="c1"># ./usr/local</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRLOCALBIN&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">)</span>    <span class="c1"># ./usr/local/bin</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRSBIN&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;sbin&quot;</span><span class="p">)</span>     <span class="c1"># ./usr/sbin</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRSHARE&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">)</span>    <span class="c1"># ./usr/share</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRSRC&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;usr&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">)</span>      <span class="c1"># ./usr/src</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VAR&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">)</span>            <span class="c1"># ./var</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VARCACHE&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;cache&quot;</span><span class="p">)</span>    <span class="c1"># ./var/cache</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VARLIB&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">)</span>      <span class="c1"># ./var/lib</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VARLOCK&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;lock&quot;</span><span class="p">)</span>     <span class="c1"># ./var/lock</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_LOG&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">)</span>      <span class="c1"># ./var/log</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VARMAIL&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;mail&quot;</span><span class="p">)</span>     <span class="c1"># ./var/mail</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VAROPT&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;opt&quot;</span><span class="p">)</span>      <span class="c1"># ./var/opt</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VARRUN&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">)</span>      <span class="c1"># ./var/run</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VARSPOOL&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;spool&quot;</span><span class="p">)</span>    <span class="c1"># ./var/spool</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_VARTMP&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>      <span class="c1"># ./var/tmp</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WWW&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="p">,</span> <span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;www&quot;</span><span class="p">)</span>      <span class="c1"># ./var/www</span>
    <span class="k">return</span> <span class="n">env</span></div>


<div class="viewcode-block" id="build_venv_paths_cdalias_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_venv_paths_cdalias_env">[docs]</a><span class="k">def</span> <span class="nf">build_venv_paths_cdalias_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build CdAliases for standard paths</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        env (Env dict): :py:class:`Env`</span>
<span class="sd">    Returns:</span>
<span class="sd">        env (Env dict): :py:class:`Env`</span>
<span class="sd">        with ``.aliases`` extended.</span>

<span class="sd">    .. note:: These do not work in IPython as they run in a subshell.</span>
<span class="sd">       See: :py:mod:`dotfiles.venv.venv_ipymagics`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>

    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdhome&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span>         <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdh&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdwrk&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">)</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdddotfiles&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;__DOTFILES&#39;</span><span class="p">,</span>   <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">])</span>

    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdprojecthome&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;PROJECT_HOME&#39;</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdp&#39;</span><span class="p">,</span> <span class="s1">&#39;cdph&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdworkonhome&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>  <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdwh&#39;</span><span class="p">,</span> <span class="s1">&#39;cdve&#39;</span><span class="p">])</span>

    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdcondaenvspath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;CONDA_ENVS_PATH&#39;</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cda&#39;</span><span class="p">,</span> <span class="s1">&#39;cdce&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdcondaroot&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;CONDA_ROOT&#39;</span><span class="p">,</span>   <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdr&#39;</span><span class="p">])</span>

    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdvirtualenv&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span>  <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdv&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdsrc&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_SRC&#39;</span><span class="p">,</span>         <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cds&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdwrd&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">,</span>         <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdw&#39;</span><span class="p">])</span>

    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdbin&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_BIN&#39;</span><span class="p">,</span>         <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdb&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdetc&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_ETC&#39;</span><span class="p">,</span>         <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cde&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdlib&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_LIB&#39;</span><span class="p">,</span>         <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdl&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdlog&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_LOG&#39;</span><span class="p">)</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdpylib&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_PYLIB&#39;</span><span class="p">)</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdpysite&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_PYSITE&#39;</span><span class="p">,</span>    <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdsitepackages&#39;</span><span class="p">])</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdvar&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_VAR&#39;</span><span class="p">)</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdwww&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">CdAlias</span><span class="p">(</span><span class="s1">&#39;_WWW&#39;</span><span class="p">,</span>         <span class="n">aliases</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cdww&#39;</span><span class="p">])</span>

    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdls&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s2">&quot;&quot;&quot;set | grep &quot;^cd.*()&quot; | cut -f1 -d&quot; &quot; #%l&quot;&quot;&quot;</span>
    <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;cdhelp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;cat $</span><span class="si">{__DOTFILES}</span><span class="s2">/&#39;&#39;scripts/venv_cdaliases.sh | pyline.py -r &#39;^</span><span class="se">\\</span><span class="s2">s*#+</span><span class="se">\\</span><span class="s2">s+.*&#39; &#39;rgx and l&#39;&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">env</span></div>


<div class="viewcode-block" id="build_user_aliases_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_user_aliases_env">[docs]</a><span class="k">def</span> <span class="nf">build_user_aliases_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">dont_reflect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">VIRTUAL_ENV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">_SRC</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">_ETC</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">_CFG</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">PROJECT_FILES</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure env variables and return an OrderedDict of aliases</span>

<span class="sd">    Args:</span>
<span class="sd">        dont_reflect (bool): Whether to always create aliases and functions</span>
<span class="sd">            referencing ``$_WRD`` even if ``$_WRD`` doesn&#39;t exist.</span>
<span class="sd">            (default: False)</span>
<span class="sd">    Returns:</span>
<span class="sd">        OrderedDict: dict of aliases</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>

    <span class="k">if</span> <span class="n">VIRTUAL_ENV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV</span>
    <span class="k">if</span> <span class="n">_SRC</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SRC</span>
    <span class="k">if</span> <span class="n">_ETC</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ETC</span>
    <span class="k">if</span> <span class="n">_CFG</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_CFG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CFG</span>
    <span class="k">if</span> <span class="n">PROJECT_FILES</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PROJECT_FILES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PROJECT_FILES</span>

    <span class="n">PROJECT_FILES</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PROJECT_FILES&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">())</span>
    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PROJECT_FILES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PROJECT_FILES</span>

    <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">VIRTUAL_ENV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV is none&#39;</span><span class="p">)</span>
        <span class="c1"># raise Exception()</span>
    <span class="n">VIRTUAL_ENV_NAME</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span>
                               <span class="n">VIRTUAL_ENV</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">_SRC</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_SRC&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_SRC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">VIRTUAL_ENV</span><span class="p">:</span>
            <span class="n">_SRC</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_SRC</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SRC</span>
    <span class="n">_ETC</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_ETC&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_ETC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">VIRTUAL_ENV</span><span class="p">:</span>
            <span class="n">_ETC</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span> <span class="s1">&#39;etc&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_ETC</span> <span class="o">=</span> <span class="s1">&#39;/etc&#39;</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ETC</span>

    <span class="n">_APP</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_APP</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">VIRTUAL_ENV_NAME</span><span class="p">:</span>
            <span class="n">_APP</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV_NAME</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_APP</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_APP</span>

    <span class="n">_WRD</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_WRD</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_SRC</span> <span class="ow">and</span> <span class="n">_APP</span><span class="p">:</span>
            <span class="n">_WRD</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_WRD</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_WRD</span>

    <span class="k">def</span> <span class="nf">build_editor_env</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="c1"># EDITOR configuration</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIMBIN&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">distutils</span><span class="o">.</span><span class="n">spawn</span><span class="o">.</span><span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;vim&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;GVIMBIN&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">distutils</span><span class="o">.</span><span class="n">spawn</span><span class="o">.</span><span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;gvim&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;MVIMBIN&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">distutils</span><span class="o">.</span><span class="n">spawn</span><span class="o">.</span><span class="n">find_executable</span><span class="p">(</span><span class="s1">&#39;mvim&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;GUIVIMBIN&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GVIMBIN&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MVIMBIN&#39;</span><span class="p">))</span>
        <span class="c1"># set the current vim servername to _APP</span>
        <span class="n">VIMSERVER</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">if</span> <span class="n">_APP</span><span class="p">:</span>
            <span class="n">VIMSERVER</span> <span class="o">=</span> <span class="n">_APP</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIMCONF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;--servername </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">shell_quote</span><span class="p">(</span><span class="n">VIMSERVER</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GUIVIMBIN&#39;</span><span class="p">):</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDIT_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> -f&quot;</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIMBIN&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDIT_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> --remote-tab-silent&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GUIVIMBIN&#39;</span><span class="p">),</span>
                <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIMCONF&#39;</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;EDITOR_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDIT_&#39;</span><span class="p">]</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;editw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDIT_&#39;</span><span class="p">]</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;gvimw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDIT_&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">build_ipython_env</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="c1"># IPYTHON configuration</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_NOTEBOOKS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_SRC&#39;</span><span class="p">,</span>
                                            <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                                                    <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">))),</span>
                                    <span class="s1">&#39;notebooks&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_IPYSESKEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_SRC&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">)),</span>
                                    <span class="s1">&#39;.ipyseskey&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">_new_ipnbkey</span> <span class="o">=</span> <span class="s2">&quot;print os.urandom(128).encode(</span><span class="se">\\\&quot;</span><span class="s2">base64</span><span class="se">\\\&quot;</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">_new_ipnbkey</span> <span class="o">=</span> <span class="s2">&quot;print(os.urandom(128).encode(</span><span class="se">\\\&quot;</span><span class="s2">base64</span><span class="se">\\\&quot;</span><span class="s2">))&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="p">)</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;ipskey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;(python -c </span><span class="se">\&quot;</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;import os;&#39;</span>
                            <span class="s1">&#39; </span><span class="si">{_new_ipnbkey}</span><span class="se">\&quot;</span><span class="s1">&#39;</span>
                            <span class="s1">&#39; &gt; </span><span class="si">{_IPYSESKEY}</span><span class="s1"> )&#39;</span>
                            <span class="s1">&#39; &amp;&amp; chmod 0600 </span><span class="si">{_IPYSESKEY}</span><span class="s1">;&#39;</span>
                            <span class="s1">&#39; # %l&#39;</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">_new_ipnbkey</span><span class="o">=</span><span class="n">_new_ipnbkey</span><span class="p">,</span>
            <span class="n">_IPYSESKEY</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_IPYSESKEY&#39;</span><span class="p">))</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;ipnb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ipython notebook&#39;</span>
                        <span class="s1">&#39; --secure&#39;</span>
                        <span class="s1">&#39; --Session.keyfile=</span><span class="si">{_IPYSESKEY}</span><span class="s1">&#39;</span>
                        <span class="s1">&#39; --notebook-dir=</span><span class="si">{_NOTEBOOKS}</span><span class="s1">&#39;</span>
                        <span class="s1">&#39; --deep-reload&#39;</span>
                        <span class="s1">&#39; %l&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">_IPYSESKEY</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_IPYSESKEY&#39;</span><span class="p">),</span>
            <span class="n">_NOTEBOOKS</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_NOTEBOOKS&#39;</span><span class="p">))</span>

        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_IPQTLOG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span> <span class="s1">&#39;.ipqt.log&#39;</span><span class="p">)</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;ipqt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;ipython qtconsole&#39;</span>
                        <span class="s1">&#39; --secure&#39;</span>
                        <span class="s1">&#39; --Session.keyfile=</span><span class="si">{_IPYSESKEY}</span><span class="s1">&#39;</span>
                        <span class="s1">&#39; --logappend=</span><span class="si">{_IPQTLOG}</span><span class="s1">&#39;</span>
                        <span class="s1">&#39; --deep-reload&#39;</span>
                        <span class="c1">#&#39; --gui-completion&#39;</span>
                        <span class="c1">#&#39; --existing=${_APP}&#39;</span>
                        <span class="s1">&#39; --pprint&#39;</span>
                        <span class="c1">#&#39; --pdb&#39;</span>
                        <span class="s1">&#39; --colors=linux&#39;</span>
                        <span class="s1">&#39; --ConsoleWidget.font_family=&quot;Monaco&quot;&#39;</span>
                        <span class="s1">&#39; --ConsoleWidget.font_size=11&#39;</span>
                        <span class="s1">&#39; %l&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">_IPYSESKEY</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_IPYSESKEY&#39;</span><span class="p">),</span>
            <span class="n">_APP</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">),</span>
            <span class="n">_IPQTLOG</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_IPQTLOG&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">build_grin_env</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;grinv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grin --follow </span><span class="si">%%</span><span class="s1">l </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>
        <span class="n">aliases</span><span class="p">[</span>
            <span class="s1">&#39;grindv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grind --follow </span><span class="si">%%</span><span class="s1">l --dirs </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>

        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;grins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grin --follow </span><span class="si">%%</span><span class="s1">l </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_SRC&#39;</span><span class="p">)</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;grinds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grind --follow </span><span class="si">%%</span><span class="s1">l --dirs </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_SRC&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">build_wrd_aliases_env</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="n">_WRD</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">]</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_WRD</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dont_reflect</span><span class="p">:</span>

            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;lsw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IpyAlias</span><span class="p">(</span>
                <span class="s1">&#39;(cd </span><span class="si">{_WRD}</span><span class="s1">; ls $(test -n &quot;</span><span class="si">{__IS_MAC}</span><span class="s1">&quot; &amp;&amp; echo &quot;-G&quot; || echo &quot;--color=auto&quot;) %l)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">),</span>
                    <span class="n">__IS_MAC</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;__IS_MAC&#39;</span><span class="p">)),</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lsw&#39;</span><span class="p">,</span>
                <span class="n">complfuncstr</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;local cur=$</span><span class="si">{2}</span><span class="s2">;</span>
<span class="s2">                COMPREPLY=($(cd $</span><span class="si">{_WRD}</span><span class="s2">; compgen -f -- $</span><span class="si">{cur}</span><span class="s2">));&quot;&quot;&quot;</span>
            <span class="p">)</span>

            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;findw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;find </span><span class="si">{_WRD}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>
            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;grepw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grep %l </span><span class="si">{_WRD}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>

            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;grinw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grin --follow %l </span><span class="si">{_WRD}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>
            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;grindw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;grind --follow %l --dirs </span><span class="si">{_WRD}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>

            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;PROJECT_FILES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">PROJECT_FILES</span><span class="p">)</span>
            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;editp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ew $</span><span class="si">{PROJECT_FILES}</span><span class="s2"> %l&quot;</span>

            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;makewrd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;(cd </span><span class="si">{_WRD}</span><span class="s2"> &amp;&amp; make %l)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>

            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;makew&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;makewrd&#39;</span><span class="p">]</span>
            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;makewlog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;_logfile=</span><span class="se">\&quot;</span><span class="s2">$</span><span class="si">{_VARLOG}</span><span class="s2">/make.log</span><span class="se">\&quot;</span><span class="s2">; &quot;</span>
                <span class="s2">&quot;(makew %l 2&gt;&amp;1 | tee $_logfile) &amp;&amp; e $_logfile&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;app working directory </span><span class="si">%r</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="n">_WRD</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">build_python_testing_env</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_TESTPY_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;(cd </span><span class="si">{_WRD}</span><span class="s2"> &amp;&amp; python setup.py test)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;testpyw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_TESTPY_&#39;</span><span class="p">]</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;testpywr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;reset &amp;&amp; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_TESTPY_&#39;</span><span class="p">]</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;nosew&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;(cd </span><span class="si">{_WRD}</span><span class="s1"> &amp;&amp; nosetests %l)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">build_pyramid_env</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">dont_reflect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">_CFG</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">],</span> <span class="s1">&#39;development.ini&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dont_reflect</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_CFG</span><span class="p">):</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_CFG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CFG</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDITCFG_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{_EDIT_}</span><span class="s2"> </span><span class="si">{_CFG}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_EDIT_</span><span class="o">=</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDIT_&#39;</span><span class="p">],</span>
                <span class="n">_CFG</span><span class="o">=</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_CFG&#39;</span><span class="p">])</span>
            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;editcfg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{_EDITCFG}</span><span class="s2"> %l&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_EDITCFG</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_EDITCFG_&#39;</span><span class="p">))</span>
            <span class="c1"># Pyramid pshell &amp; pserve (#TODO: test -f manage.py (django))</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SHELL_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;(cd </span><span class="si">{_WRD}</span><span class="s2"> &amp;&amp; </span><span class="si">{_BIN}</span><span class="s2">/pshell </span><span class="si">{_CFG}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_BIN</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_BIN&#39;</span><span class="p">),</span>
                <span class="n">_CFG</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_CFG&#39;</span><span class="p">),</span>
                <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SERVE_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;(cd </span><span class="si">{_WRD}</span><span class="s2"> &amp;&amp; </span><span class="si">{_BIN}</span><span class="s2">/pserve&quot;</span>
                              <span class="s2">&quot; --app-name=main&quot;</span>
                              <span class="s2">&quot; --reload&quot;</span>
                              <span class="s2">&quot; --monitor-restart </span><span class="si">{_CFG}</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">_BIN</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_BIN&#39;</span><span class="p">),</span>
                <span class="n">_CFG</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_CFG&#39;</span><span class="p">),</span>
                <span class="n">_WRD</span><span class="o">=</span><span class="n">shell_varquote</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">))</span>
            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;servew&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SERVE_&#39;</span><span class="p">]</span>
            <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;shellw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SHELL_&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;app configuration </span><span class="si">%r</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="n">_CFG</span><span class="p">)</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_CFG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="k">def</span> <span class="nf">build_supervisord_env</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
        <span class="n">_SVCFG</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_SVCFG&#39;</span><span class="p">,</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">],</span> <span class="s1">&#39;supervisord.conf&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_SVCFG</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dont_reflect</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SVCFG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SVCFG</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SVCFG_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; -c </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">shell_quote</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SVCFG&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;supervisord configuration </span><span class="si">%r</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="n">_SVCFG</span><span class="p">)</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SVCFG_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;ssv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;supervisord -c &quot;$</span><span class="si">{_SVCFG}</span><span class="s1">&quot;&#39;</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;sv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;supervisorctl -c &quot;$</span><span class="si">{_SVCFG}</span><span class="s1">&quot;&#39;</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;svt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sv tail -f&#39;</span>
        <span class="n">aliases</span><span class="p">[</span><span class="s1">&#39;svd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;supervisorctl -c &quot;$</span><span class="si">{_SVCFG}</span><span class="s1">&quot; restart dev&#39;</span>
                        <span class="s1">&#39; &amp;&amp; supervisorctl -c &quot;$</span><span class="si">{_SVCFG}</span><span class="s1">&quot; tail -f dev&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">build_editor_env</span><span class="p">,</span>
        <span class="n">build_ipython_env</span><span class="p">,</span>
        <span class="n">build_grin_env</span><span class="p">,</span>
        <span class="n">build_wrd_aliases_env</span><span class="p">,</span>
        <span class="n">build_python_testing_env</span><span class="p">,</span>
        <span class="n">build_pyramid_env</span><span class="p">,</span>
        <span class="n">build_supervisord_env</span><span class="p">]</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">StepBuilder</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span></div>


<div class="viewcode-block" id="build_usrlog_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_usrlog_env">[docs]</a><span class="k">def</span> <span class="nf">build_usrlog_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">_TERM_ID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">shell</span><span class="o">=</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span>
                     <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">USER</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">HOSTNAME</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">lookup_hostname</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build environment variables and configuration like usrlog.sh</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>
<span class="sd">        _TERM_ID (str): terminal identifier string</span>
<span class="sd">        shell (str): shell name (&quot;bash&quot;, &quot;zsh&quot;)</span>
<span class="sd">        prefix (str): a path prefix (e.g. ``$VIRTUAL_ENV`` or ``$PREFIX``)</span>
<span class="sd">        USER (str): system username (``$USER``) for ``HISTTIMEFORMAT``</span>
<span class="sd">        HOSTNAME (str): system hostname (``HOSTNAME``) for ``HISTTIMEFORMAT``</span>
<span class="sd">        lookup_hostname (bool): if True, ``HOSTNAME`` is None,</span>
<span class="sd">            and not env.get(&#39;HOSTNAME&#39;), try to read ``HOSTNAME``</span>
<span class="sd">            from ``os.environ`` and then ``socket.gethostname()``.</span>
<span class="sd">    Returns:</span>
<span class="sd">        env (Env dict): :py:class:`dotfiles.venv.venv_ipyconfig.Env`</span>

<span class="sd">    .. note:: Like ``usrlog.sh``, when ``HISTTIMEFORMAT`` is set,</span>
<span class="sd">        ``USER`` and ``HOSTNAME`` must be evaluated.</span>

<span class="sd">        (When ``USER`` and ``HOSTNAME`` change, ``HISTTIMEFORMAT``</span>
<span class="sd">        is not updated, and the .history file will contain only</span>
<span class="sd">        the most recent USER and HOSTNAME settings,</span>
<span class="sd">        which are not necessarily the actual USER and HOSTNAME.)</span>

<span class="sd">        TODO: could/should instead (also) write USER and HOSTNAME</span>
<span class="sd">        to -usrlog.log.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                               <span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">))</span>
        <span class="c1">#env[&#39;HOSTNAME&#39;] = HOSTNAME</span>
        <span class="c1">#env[&#39;USER&#39;] = USER</span>

    <span class="c1">#HOSTNAME = env.get(&#39;HOSTNAME&#39;)</span>
    <span class="c1"># if HOSTNAME is None:</span>
        <span class="c1"># if lookup_hostname:</span>
            <span class="c1">#HOSTNAME = os.environ.get(&#39;HOSTNAME&#39;)</span>
            <span class="c1"># if HOSTNAME is None:</span>
                <span class="c1">#HOSTNAME = __import__(&#39;socket&#39;).gethostname()</span>
        <span class="c1">#env[&#39;HOSTNAME&#39;] = HOSTNAME</span>
    <span class="c1"># env[&#39;HISTTIMEFORMAT&#39;]   = &#39;%F %T%z  {USER}  {HOSTNAME}  &#39;.format(</span>
        <span class="c1"># USER=env.get(&#39;USER&#39;,&#39;-&#39;),</span>
        <span class="c1"># HOSTNAME=env.get(&#39;HOSTNAME&#39;,&#39;-&#39;))</span>
    <span class="c1">#env[&#39;HISTSIZE&#39;]         = 1000000</span>
    <span class="c1">#env[&#39;HISTFILESIZE&#39;]     = 1000000</span>

    <span class="c1"># user default usrlog</span>
    <span class="c1"># env[&#39;__USRLOG&#39;] = joinpath(env[&#39;HOME&#39;], &#39;-usrlog.log&#39;)</span>

    <span class="c1"># current usrlog</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">))</span>

    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_USRLOG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;-usrlog.log&quot;</span><span class="p">)</span>
    <span class="c1">#_term_id = _TERM_ID if _TERM_ID is not None else (</span>
    <span class="c1">#    term_id_from_environ and os.environ.get(&#39;_TERM_ID&#39;))</span>
    <span class="c1">#if _term_id:</span>
    <span class="c1">#    env[&#39;_TERM_ID&#39;] = _term_id</span>
    <span class="c1"># env[&#39;_TERM_URI&#39;]    = _TERM_ID  # TODO</span>

    <span class="c1"># shell HISTFILE</span>
    <span class="c1"># if shell == &#39;bash&#39;:</span>
        <span class="c1">#env[&#39;HISTFILE&#39;] = joinpath(prefix, &quot;.bash_history&quot;)</span>
    <span class="c1"># elif shell == &#39;zsh&#39;:</span>
        <span class="c1">#env[&#39;HISTFILE&#39;] = joinpath(prefix, &quot;.zsh_history&quot;)</span>
    <span class="c1"># else:</span>
        <span class="c1">#env[&#39;HISTFILE&#39;] = joinpath(prefix, &#39;.history&#39;)</span>

    <span class="k">return</span> <span class="n">env</span></div>


<div class="viewcode-block" id="build_venv_activate_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_venv_activate_env">[docs]</a><span class="k">def</span> <span class="nf">build_venv_activate_env</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">VENVSTR</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">VENVSTRAPP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">from_environ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">VENVPREFIX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">VIRTUAL_ENV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">VIRTUAL_ENV_NAME</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">_APP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">_SRC</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">_WRD</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span>
        <span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span>
        <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_APP&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_SRC&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_WRD&#39;</span><span class="p">,</span>
    <span class="p">]</span>


    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>


    <span class="n">_SENTINEL</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_SENTINEL</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">Venv</span><span class="o">.</span><span class="n">parse_VENVSTR</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
                            <span class="n">from_environ</span><span class="o">=</span><span class="n">from_environ</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">))</span>

    <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">VIRTUAL_ENV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">env</span>

    <span class="n">VIRTUAL_ENV_NAME</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">VIRTUAL_ENV_NAME</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">_APP</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_APP</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">VIRTUAL_ENV_NAME</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_APP</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV_NAME</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_APP</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_APP</span>

    <span class="n">_ETC</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_ETC&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_ETC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_ETC</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span> <span class="s1">&#39;etc&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ETC</span>

    <span class="n">_SRC</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_SRC&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_SRC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_SRC</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_SRC</span>

    <span class="n">_WRD</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_WRD&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_WRD</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_WRD</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_WRD</span>
    <span class="k">return</span> <span class="n">env</span></div>


<div class="viewcode-block" id="Env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env">[docs]</a><span class="k">class</span> <span class="nc">Env</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OrderedDict of variables for/from ``os.environ``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">osenviron_keys_classic</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c1"># Comment example paths have a trailing slash,</span>
        <span class="c1"># test and actual paths should not have a trailing slash</span>
        <span class="c1"># from os.path import join as joinpath</span>

        <span class="c1"># editors</span>
        <span class="s1">&#39;VIMBIN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GVIMBIN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MVIMBIN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GUIVIMBIN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;VIMCONF&#39;</span><span class="p">,</span>
        <span class="s1">&#39;EDITOR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;EDITOR_&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PAGER&#39;</span><span class="p">,</span>
        <span class="c1"># venv</span>
        <span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>            <span class="c1"># ~/-wrk/</span>
        <span class="s1">&#39;__DOTFILES&#39;</span><span class="p">,</span>
        <span class="c1"># virtualenvwrapper</span>
        <span class="s1">&#39;PROJECT_HOME&#39;</span><span class="p">,</span>     <span class="c1"># ~/-wrk/ #$__WRK</span>
        <span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>      <span class="c1"># ~/-wrk/-ve27/</span>
        <span class="s1">&#39;WORKON_HOME__py27&#39;</span><span class="p">,</span>      <span class="c1"># ~/-wrk/-ve27/</span>
        <span class="s1">&#39;WORKON_HOME__py34&#39;</span><span class="p">,</span>      <span class="c1"># ~/-wrk/-ve34/</span>
        <span class="c1"># venv</span>
        <span class="c1"># ~/-wrk/-ve27/dotfiles/ # ${VENVPREFIX:-${VIRTUAL_ENV}}</span>
        <span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span>
        <span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span>         <span class="c1"># &quot;dotfiles&quot;</span>
        <span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>      <span class="c1"># &quot;dotfiles&quot;, &quot;dotfiles/docs&quot;</span>
        <span class="s1">&#39;_APP&#39;</span><span class="p">,</span>             <span class="c1"># dotfiles/tests</span>
        <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span>  <span class="c1"># &quot;dotfiles&quot;</span>
        <span class="c1"># virtualenv</span>
        <span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span>      <span class="c1"># ~/-wrk/-ve27/dotfiles/  # ${VIRTUAL_ENV_NAME}</span>
        <span class="c1"># venv</span>
        <span class="s1">&#39;_SRC&#39;</span><span class="p">,</span>  <span class="c1"># ~/-wrk/-ve27/dotfiles/src/  # ${VIRTUAL_ENV}/src</span>
        <span class="s1">&#39;_ETC&#39;</span><span class="p">,</span>  <span class="c1"># ~/-wrk/-ve27/dotfiles/etc/  # ${VIRTUAL_ENV}/etc</span>

        <span class="s1">&#39;_BIN&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_CFG&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_LIB&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_LOG&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_MNT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_OPT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_PYLIB&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_PYSITE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_SRV&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_VAR&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_WRD&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_WRD_SETUPY&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_WWW&#39;</span><span class="p">,</span>

        <span class="c1"># dotfiles</span>
        <span class="s1">&#39;__SRC&#39;</span><span class="p">,</span>
        <span class="s1">&#39;__DOCSWWW&#39;</span><span class="p">,</span>
        <span class="c1"># usrlog</span>
        <span class="s1">&#39;_USRLOG&#39;</span><span class="p">,</span>
        <span class="s1">&#39;__USRLOG&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_TERM_ID&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_TERM_URI&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">osenviron_keys</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span>
<span class="c1">## &lt;env&gt;</span>
        <span class="c1"># (&quot;HOME&quot;, &quot;/Users/W&quot;),</span>
        <span class="p">(</span><span class="s2">&quot;__WRK&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{HOME}</span><span class="s2">/-wrk&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;__SRC&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-src&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;__DOTFILES&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{HOME}</span><span class="s2">/-dotfiles&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;__WRK&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{HOME}</span><span class="s2">/-wrk&quot;</span><span class="p">),</span>
        <span class="c1">#(&quot;PROJECT_HOME&quot;, &quot;${HOME}/-wrk&quot;),</span>
        <span class="p">(</span><span class="s2">&quot;PROJECT_HOME&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ROOT&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-conda27&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ENVS_PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ce27&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;WORKON_HOME&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ve27&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;VENVSTR&quot;</span><span class="p">,</span> <span class="s2">&quot;dotfiles&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;VENVSTRAPP&quot;</span><span class="p">,</span> <span class="s2">&quot;dotfiles&quot;</span><span class="p">),</span> <span class="c1"># or None</span>
        <span class="p">(</span><span class="s2">&quot;VIRTUAL_ENV_NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;dotfiles&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;VIRTUAL_ENV&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{WORKON_HOME}</span><span class="s2">/$</span><span class="si">{VIRTUAL_ENV_NAME}</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;VENVPREFIX&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="c1"># or /</span>
        <span class="p">(</span><span class="s2">&quot;_APP&quot;</span><span class="p">,</span> <span class="s2">&quot;dotfiles&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_ETC&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/etc&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_SRC&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/src&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_WRD&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_SRC}</span><span class="s2">/dotfiles&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_BIN&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/bin&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_ETCOPT&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_ETC}</span><span class="s2">/opt&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_HOME&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/home&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_LIB&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/lib&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_PYLIB&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_LIB}</span><span class="s2">/python2.7&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_PYSITE&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_PYLIB}</span><span class="s2">/site-packages&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_MNT&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/mnt&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_MEDIA&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/media&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_OPT&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/opt&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_ROOT&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/root&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_SBIN&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/sbin&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_SRV&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/srv&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_TMP&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/tmp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USR&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRBIN&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/bin&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRINCLUDE&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/include&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRLIB&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/lib&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRLOCAL&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/local&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRLOCALBIN&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/local/bin&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRSBIN&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/sbin&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRSHARE&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/share&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_USRSRC&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/usr/src&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VAR&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{VIRTUAL_ENV}</span><span class="s2">/var&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VARCACHE&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/cache&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VARLIB&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/lib&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VARLOCK&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/lock&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_LOG&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/log&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VARMAIL&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/mail&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VAROPT&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/opt&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VARRUN&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/run&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VARSPOOL&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/spool&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_VARTMP&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/tmp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;_WWW&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{_VAR}</span><span class="s2">/www&quot;</span><span class="p">),</span>

        <span class="p">(</span><span class="s2">&quot;WORKON_HOME__py27&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ve27&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;WORKON_HOME__py34&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ve34&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;WORKON_HOME__py35&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ve35&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;WORKON_HOME__py36&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ve36&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;WORKON_HOME__py37&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ve37&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;WORKON_HOME_DEFAULT&quot;</span><span class="p">,</span> <span class="s2">&quot;WORKON_HOME__py37&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ROOT__py27&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-conda27&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ENVS__py27&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ce27&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ROOT__py34&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-conda34&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ENVS__py34&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ce34&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ROOT__py35&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-conda35&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ENVS__py35&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ce35&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ROOT__py36&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-conda36&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ENVS__py36&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ce36&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ROOT__py37&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-conda37&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;CONDA_ENVS__py37&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="si">{__WRK}</span><span class="s2">/-ce37&quot;</span><span class="p">),</span>
        <span class="c1">#(&quot;CONDA_ROOT_DEFAULT&quot;, &quot;CONDA_ROOT__py27&quot;),</span>
        <span class="c1">#(&quot;CONDA_ENVS_DEFAULT&quot;, &quot;CONDA_ENVS__py27&quot;),</span>
        <span class="c1">#(&quot;PROJECT_FILES&quot;, &quot;&quot;),</span>
        <span class="c1">#(&quot;VIMBIN&quot;, &quot;/usr/bin/vim&quot;),</span>
        <span class="c1">#(&quot;GVIMBIN&quot;, &quot;/usr/local/bin/gvim&quot;),</span>
        <span class="c1">#(&quot;MVIMBIN&quot;, &quot;/usr/local/bin/mvim&quot;),</span>
        <span class="c1">#(&quot;GUIVIMBIN&quot;, &quot;/usr/local/bin/gvim&quot;),</span>
        <span class="c1">#(&quot;VIMCONF&quot;, &quot;--servername dotfiles&quot;),</span>
        <span class="c1">#(&quot;_EDIT_&quot;, &quot;/usr/local/bin/gvim --servername dotfiles --remote-tab-silent&quot;),</span>
        <span class="c1">#(&quot;EDITOR_&quot;, &quot;/usr/local/bin/gvim --servername dotfiles --remote-tab-silent&quot;),</span>
        <span class="c1">#(&quot;_NOTEBOOKS&quot;, &quot;${_SRC}/notebooks&quot;),</span>
        <span class="c1">#(&quot;_IPYSESKEY&quot;, &quot;${_SRC}/.ipyseskey&quot;),</span>
        <span class="c1">#(&quot;_IPQTLOG&quot;, &quot;${VIRTUAL_ENV}/.ipqt.log&quot;),</span>
        <span class="c1">#(&quot;_WRD_SETUPY&quot;, &quot;${_WRD}/setup.py&quot;),</span>
        <span class="c1">#(&quot;_TEST_&quot;, &quot;(cd {_WRD} &amp;&amp; python \&quot;${_WRD_SETUPY}\&quot; test)&quot;),</span>
        <span class="c1">#(&quot;_CFG&quot;, &quot;${_ETC}/development.ini&quot;),</span>
        <span class="c1">#(&quot;_EDITCFG_&quot;, &quot;/usr/local/bin/gvim --servername dotfiles --remote-tab-silent ${_ETC}/development.ini&quot;),</span>
        <span class="c1">#(&quot;_SHELL_&quot;, &quot;(cd {_WRD} &amp;&amp; \&quot;${_BIN}\&quot;/pshell \&quot;${_CFG}\&quot;)&quot;),</span>
        <span class="c1">#(&quot;_SERVE_&quot;, &quot;(cd {_WRD} &amp;&amp; \&quot;${_BIN}\&quot;/pserve --app-name=main --reload --monitor-restart \&quot;${_CFG}\&quot;)&quot;),</span>
        <span class="c1">#(&quot;_SVCFG&quot;, &quot;${_ETC}/supervisord.conf&quot;),</span>
        <span class="c1">#(&quot;_SVCFG_&quot;, &quot; -c \&quot;${_ETC}/supervisord.conf\&quot;&quot;),</span>
        <span class="c1">#(&quot;__USRLOG&quot;, &quot;${HOME}/-usrlog.log&quot;),</span>
        <span class="c1">#(&quot;_USRLOG&quot;, &quot;${VIRTUAL_ENV}/-usrlog.log&quot;),</span>
    <span class="p">))</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="s2">&quot;__init__&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_name&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))))</span>

<div class="viewcode-block" id="Env.logevent"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.logevent">[docs]</a>    <span class="k">def</span> <span class="nf">logevent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#kwargs[&#39;logger&#39;] = self.log</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;env&#39;</span><span class="p">):</span>
            <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;env </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">logevent</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logevent</span><span class="p">(</span><span class="s2">&quot;envexport&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logevent</span><span class="p">(</span><span class="s2">&quot;env[k]  &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">v</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logevent</span><span class="p">(</span><span class="s2">&quot;env[k]  &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Env.iterkeys"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.iterkeys">[docs]</a>    <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">osenviron_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">allkeys</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">([</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span>
                             <span class="n">keys</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">allkeys</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="Env.iteritems_environ"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.iteritems_environ">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems_environ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>


<div class="viewcode-block" id="Env.iteritems"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.iteritems">[docs]</a>    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;environ&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iteritems_environ</span><span class="p">()))</span>
        <span class="k">yield</span> <span class="p">(</span><span class="s1">&#39;aliases&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span></div>

<div class="viewcode-block" id="Env.get"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="Env.copy"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;env.copy&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">Env</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">==</span> <span class="n">env</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">==</span> <span class="n">env</span><span class="o">.</span><span class="n">aliases</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s1">&#39;keys&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="o">==</span> <span class="n">env</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Env.from_environ"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.from_environ">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_environ</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build an ``Env`` from a dict (e.g. ``os.environ``)</span>

<span class="sd">        Args:</span>
<span class="sd">            environ (dict): a dict with variable name keys and values</span>
<span class="sd">            verbose (bool): whether to be verbose about dict merging</span>
<span class="sd">        Returns:</span>
<span class="sd">            Env: an Env environment built from the given environ dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">osenviron_keys</span><span class="p">)</span>
        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;env.from_environ&#39;</span><span class="p">,</span>
                 <span class="n">env</span><span class="p">,</span> <span class="c1"># OrderedDict(environ).items(), indent=2),</span>
                 <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">splitlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span></div>

<div class="viewcode-block" id="Env.compress_paths"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.compress_paths">[docs]</a>    <span class="k">def</span> <span class="nf">compress_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keyname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an arbitrary string,</span>
<span class="sd">        replace absolute paths (starting with &#39;/&#39;)</span>
<span class="sd">        with the longest matching Env path variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_ (str): a path string</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: path string containing ``${VARNAME}`` variables</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">keylist</span> <span class="o">=</span> <span class="n">keys</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#keys_longest_to_shortest</span>
            <span class="n">keydict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">osenviron_keys</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">other_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keydict</span><span class="p">]</span>
            <span class="n">default_keys</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">keydict</span><span class="p">)</span> <span class="o">+</span>
                            <span class="p">[</span> <span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;_SRC&#39;</span><span class="p">,</span> <span class="s1">&#39;_ETC&#39;</span><span class="p">,</span> <span class="s1">&#39;_WRD&#39;</span><span class="p">])</span>
            <span class="n">keylist</span> <span class="o">=</span> <span class="n">default_keys</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">other_keys</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_</span><span class="p">,</span> <span class="n">STR_TYPES</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">path_</span>
        <span class="n">_path</span> <span class="o">=</span> <span class="n">path_</span>
        <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">STR_TYPES</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
                <span class="n">_path</span> <span class="o">=</span> <span class="n">_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s1">&#39;${</span><span class="si">%s</span><span class="s1">}/&#39;</span> <span class="o">%</span> <span class="n">varname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span> <span class="s1">&#39;VENVSTR&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">keyname</span> <span class="o">==</span> <span class="n">varname</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">STR_TYPES</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">_path</span><span class="p">:</span>
                    <span class="n">_path</span> <span class="o">=</span> <span class="n">_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;${</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">varname</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_path</span></div>

<div class="viewcode-block" id="Env.to_string_iter"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.to_string_iter">[docs]</a>    <span class="k">def</span> <span class="nf">to_string_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">yield</span> <span class="s1">&#39;## &lt;env&gt;&#39;</span>
        <span class="n">compress_paths</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;compress_paths&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems_environ</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">compress_paths</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keyname</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2">=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">yield</span> <span class="s1">&#39;## &lt;/env&gt;&#39;</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#return u&#39;\n&#39;.join(self.to_string_iter())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Env: len=</span><span class="si">%d</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="c1"># XXX</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
        <span class="c1">#&quot;Env: &quot; + repr(str(self))</span>

<div class="viewcode-block" id="Env.ndiff"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.ndiff">[docs]</a>    <span class="k">def</span> <span class="nf">ndiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_env</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            other_env (Env): env to compare with</span>
<span class="sd">        Returns:</span>
<span class="sd">            iterable: strings from difflib.ndiff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other_env</span><span class="p">,</span> <span class="s1">&#39;to_string_iter&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;can only compare envs with envs&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_string_iter</span><span class="p">()),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">other_env</span><span class="o">.</span><span class="n">to_string_iter</span><span class="p">()))</span></div>

<div class="viewcode-block" id="Env.to_dict"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span></div>

<div class="viewcode-block" id="Env.to_json"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Env.to_json">[docs]</a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">jsonstr</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">VenvJSONEncoder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonstr</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n\n\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">_dict</span><span class="p">))</span>
            <span class="k">raise</span></div></div>


<div class="viewcode-block" id="shell_quote"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.shell_quote">[docs]</a><span class="k">def</span> <span class="nf">shell_quote</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Escape single quotes and add double quotes around a given variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        _str (str): string to add quotes to</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: string wrapped in quotes</span>

<span class="sd">    .. warning:: This is not safe for untrusted input and only valid</span>
<span class="sd">       in this context (``os.environ``).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_repr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">_repr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="shell_varquote"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.shell_varquote">[docs]</a><span class="k">def</span> <span class="nf">shell_varquote</span><span class="p">(</span><span class="n">str_</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add doublequotes and shell variable brackets to a string</span>

<span class="sd">    Args:</span>
<span class="sd">        str_ (str): string to varquote (e.g. ``VIRTUAL_ENV``)</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: &quot;${VIRTUAL_ENV}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">shell_quote</span><span class="p">(</span><span class="s1">&#39;${</span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="n">str_</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_get_shell_version</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        tuple: (shell_namestr, versionstr) of the current ``$SHELL``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shell</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SHELL&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">shell</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;SHELL is not set&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
        <span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;GNU bash, version &#39;</span><span class="p">):</span>
        <span class="n">verstr</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;GNU bash, version &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="n">verstr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;zsh &#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_shell_supports_declare_g</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True only if the ``$SHELL`` is known to support ``declare -g``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: OSX still has bash 3.2, which does not support &#39;-g&#39;</span>
    <span class="n">shell</span><span class="p">,</span> <span class="n">verstr</span> <span class="o">=</span> <span class="n">_get_shell_version</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;zsh&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">shell</span> <span class="o">==</span> <span class="s1">&#39;bash&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verstr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="Venv"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv">[docs]</a><span class="k">class</span> <span class="nc">Venv</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A virtual environment configuration generator</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">VENVSTR</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">VENVSTRAPP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">__WRK</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">__DOTFILES</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">WORKON_HOME</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">VIRTUAL_ENV_NAME</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">VENVPREFIX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">VIRTUAL_ENV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">_SRC</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">_APP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">_WRD</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">from_environ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">open_editors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">open_terminals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">dont_reflect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">show_diffs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new Venv from a default configuration</span>

<span class="sd">        Keyword Arguments:</span>

<span class="sd">            env (Env): initial Env</span>

<span class="sd">            VENVSTR (str): VIRTUAL_ENV_NAME (&#39;dotfiles&#39;) or VIRTUAL_ENV</span>
<span class="sd">                (&#39;$WORKON_HOME/dotfiles&#39;)</span>

<span class="sd">            VENVSTRAPP (str): _APP (&#39;dotfiles&#39;, &#39;dotfiles/etc/bash&#39;)</span>

<span class="sd">            __WRK (str): None (~/-wrk) OR</span>
<span class="sd">                path to a workspace root</span>
<span class="sd">                containing one or more ``WORKON_HOME`` directories</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test $__WRK == echo &quot;${HOME}/-wrk&quot;</span>
<span class="sd">                    cdwrk</span>

<span class="sd">            __DOTFILES (str): None or path to dotfiles symlink</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test &quot;${__DOTFILES}&quot; == &quot;~/-dotfiles&quot;</span>
<span class="sd">                    cddotfiles ; cdd</span>

<span class="sd">            WORKON_HOME (str): path to a ``WORKON_HOME`` directory</span>
<span class="sd">                containing zero or more &#39;VIRTUAL_ENV`` directories</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test $WORKON_HOME == echo &quot;${__WRK}/-ve27&quot;</span>
<span class="sd">                    cdworkonhome ; cdwh</span>


<span class="sd">            VIRTUAL_ENV_NAME (str): None or a string path component</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test &quot;$VIRTUAL_ENV&quot; == &quot;${WORKON_HOME}/${VIRTUAL_ENV_NAME}&quot;</span>
<span class="sd">                    cdvirtualenv ; cdv</span>

<span class="sd">                .. note:: if None (not specified),</span>
<span class="sd">                   ``VIRTUAL_ENV_NAME`` defaults to</span>
<span class="sd">                   the basename of ``$VIRTUAL_ENV``</span>
<span class="sd">                   or what is in ``os.environ``, if ``from_environ`` is True)</span>


<span class="sd">            VENVPREFIX (str): for when VIRTUAL_ENV is not set {/,~,~/-wrk}</span>
<span class="sd">                some paths may not make sense with PREFIX=/.</span>
<span class="sd">                #TODO: list sensible defaults</span>
<span class="sd">                # the issue here is whether to raise an error when</span>
<span class="sd">                VENVSTR or VIRTUAL_ENV are not specified.</span>

<span class="sd">            VIRTUAL_ENV (str): None, a path to a virtualenv, or the basename</span>
<span class="sd">                of a virtualenv in ``$WORKON_HOME``</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test &quot;$VIRTUAL_ENV&quot; == &quot;${WORKON_HOME}/${VIRTUAL_ENV_NAME}&quot;</span>
<span class="sd">                    cdvirtualenv ; cdv</span>

<span class="sd">                .. note:: if not specified,</span>
<span class="sd">                   ``$_APP`` defaults to the basename of ``$VIRTUAL_ENV``</span>
<span class="sd">                    (or what is in os.environ, if ``from_environ`` is True)</span>

<span class="sd">            _SRC (str): None or a string path component</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test &quot;$_SRC&quot; == &quot;${VIRTUAL_ENV}/src&quot;</span>
<span class="sd">                    cdsrc ; cds</span>

<span class="sd">            _APP (str): None or a string path component</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test &quot;${_SRC}/${_APP}&quot; == &quot;${_WRD}&quot;</span>
<span class="sd">                    cdwrd ; cdw</span>

<span class="sd">                .. note:: if not specified,</span>
<span class="sd">                   ``$_APP`` defaults to the basename of ``$VIRTUAL_ENV``</span>
<span class="sd">                    (or what is in os.environ, if ``from_environ`` is True)</span>

<span class="sd">            _WRD (str): None or path to working directory</span>

<span class="sd">                .. code:: bash</span>

<span class="sd">                    test &quot;${_SRC}/${_APP}&quot; == &quot;${_WRD}&quot;</span>
<span class="sd">                    cdwrd ; cdw</span>

<span class="sd">            env (Env): an initial Env with zero or more values for self.env</span>
<span class="sd">                (default: None)</span>
<span class="sd">            from_environ (bool): read self.env from ``os.environ``</span>
<span class="sd">                (default: False)</span>
<span class="sd">            open_editors (bool): Open an editor with Venv.project_files</span>
<span class="sd">                (default: False)</span>
<span class="sd">            open_terminals (bool): Open terminals for the Venv</span>
<span class="sd">                (default: False)</span>
<span class="sd">            dont_reflect (bool): Always create aliases and functions</span>
<span class="sd">                referencing ``$_WRD`` even if ``$_WRD`` doesn&#39;t exist.</span>
<span class="sd">                (default: True)</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception: if both ``env`` and ``from_environ=True`` are specified</span>
<span class="sd">            Exception: if VIRTUAL_ENV is not specified or incalculable</span>
<span class="sd">                from the given combination of</span>
<span class="sd">                ``virtualenv`` and ``from_environ`` arguments</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">from_environ</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="o">.</span><span class="n">from_environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;both &#39;env&#39; and &#39;from_environ=True&#39; were specified&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
            <span class="s1">&#39;__DOTFILES&#39;</span><span class="p">,</span>
            <span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_APP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_SRC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_WRD&#39;</span><span class="p">]</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

        <span class="n">_SENTINEL</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_SENTINEL</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_SENTINEL</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">VENVSTR</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VENVSTR</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Venv</span><span class="o">.</span><span class="n">parse_VENVSTR</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
                                     <span class="n">from_environ</span><span class="o">=</span><span class="n">from_environ</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="n">built_envs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
                                <span class="n">from_environ</span><span class="o">=</span><span class="n">from_environ</span><span class="p">,</span>
                                <span class="n">dont_reflect</span><span class="o">=</span><span class="n">dont_reflect</span><span class="p">,</span>
                                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
                                <span class="n">show_diffs</span><span class="o">=</span><span class="n">show_diffs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">built_envs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigException</span><span class="p">(</span><span class="n">built_envs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">built_envs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">open_editors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_editors</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">open_terminals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_terminals</span><span class="p">()</span>

<div class="viewcode-block" id="Venv.build"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">VENVSTR</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">VENVSTRAPP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">VENVPREFIX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">from_environ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">dont_reflect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">show_diffs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">build_user_aliases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">build_userlog_env</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build :py:class:`Venv` :py:class:`Steps` with :py:class:`StepBuilder`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">VENVSTR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VENVSTR</span>
        <span class="k">if</span> <span class="n">VENVSTRAPP</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VENVSTRAPP</span>
        <span class="k">if</span> <span class="n">VENVPREFIX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VENVPREFIX</span>

        <span class="n">conf</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;from_environ&#39;</span><span class="p">:</span> <span class="n">from_environ</span><span class="p">,</span>
            <span class="s1">&#39;dont_reflect&#39;</span><span class="p">:</span> <span class="n">dont_reflect</span><span class="p">,</span>
            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="n">debug</span><span class="p">,</span>
            <span class="s1">&#39;show_diffs&#39;</span><span class="p">:</span> <span class="n">show_diffs</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="n">StepBuilder</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">PrintEnvStderrStep</span><span class="p">)</span>

        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_dotfiles_env</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_virtualenvwrapper_env</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_venv_activate_env</span><span class="p">)</span>

        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_conda_env</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_conda_cfg_env</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_venv_activate_env</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_venv_paths_full_env</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_venv_paths_cdalias_env</span><span class="p">)</span>

        <span class="c1"># if you would like to fork, fork.</span>
        <span class="c1"># if you would like to submit a patch or a pull request, please do.</span>

        <span class="k">if</span> <span class="n">build_user_aliases</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_user_aliases_env</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">build_usrlog_env</span><span class="p">:</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">build_usrlog_env</span><span class="p">)</span>

        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;Venv.build&#39;</span><span class="p">,</span>
                 <span class="nb">dict</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">),</span>
                 <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">new_env</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="c1">#logevent(&#39;Venv.build&#39;, dict(env=env, conf=conf), wrap=True, level=logging.INFO)</span>
        <span class="k">return</span> <span class="n">new_env</span></div>

<div class="viewcode-block" id="Venv.parse_VENVSTR"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.parse_VENVSTR">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse_VENVSTR</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">VENVSTR</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">VENVSTRAPP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">VENVPREFIX</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">VIRTUAL_ENV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">VIRTUAL_ENV_NAME</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">_APP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">_SRC</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">_WRD</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">__WRK</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">WORKON_HOME</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">from_environ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the path to a virtualenv given a ``VENVSTR``</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            env (Env):</span>
<span class="sd">            VENVSTR (str): a path to a virtualenv containing ``/``</span>
<span class="sd">                OR just the name of a virtualenv in ``$WORKON_HOME``</span>
<span class="sd">            VENVSTRAPP (str):</span>
<span class="sd">            VENVPREFIX (str):</span>
<span class="sd">            WORKON_HOME (str):</span>
<span class="sd">            from_environ (bool): whether to try and read from</span>
<span class="sd">                ``os.environ[&quot;VIRTUAL_ENV&quot;]``</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: a path to a virtualenv (for ``$VIRTUAL_ENV``)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
            <span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_APP&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_SRC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_WRD&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">from_environ</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">VENVSTR</span> <span class="ow">or</span> <span class="n">VENVSTRAPP</span> <span class="ow">or</span> <span class="n">VENVPREFIX</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigException</span><span class="p">(</span>
                    <span class="s2">&quot;from_environ=True cannot be specified with any of &quot;</span>
                    <span class="s2">&quot;[VENVSTR, VENVSTRAPP, VENVPREFIX]&quot;</span><span class="p">)</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="o">.</span><span class="n">from_environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>

        <span class="n">SENTINEL</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_vars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">SENTINEL</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SENTINEL</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">env</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;parse_VENVSTR_input&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s1">&#39;env&#39;</span><span class="p">:</span> <span class="n">env</span><span class="p">})</span>

        <span class="n">WORKON_HOME</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get_WORKON_HOME_default</span><span class="p">())</span>
        <span class="n">VENVSTR</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VENVSTR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VENVSTR</span>
        <span class="n">VENVSTRAPP</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">))</span>

        <span class="n">_APP</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>
                                     <span class="n">default</span><span class="o">=</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">VENVSTR</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VENVSTR</span><span class="p">:</span>
                <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">WORKON_HOME</span><span class="p">,</span> <span class="n">VENVSTR</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">VENVSTR</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">VENVSTRAPP</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">VIRTUAL_ENV_NAME</span> <span class="o">=</span> <span class="n">VENVSTRAPP</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_APP</span> <span class="o">=</span> <span class="n">VENVSTRAPP</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">VIRTUAL_ENV</span><span class="p">:</span>
                <span class="n">VIRTUAL_ENV_NAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">VIRTUAL_ENV</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">VIRTUAL_ENV_NAME</span> <span class="o">=</span> <span class="n">VENVSTR</span>
            <span class="n">_APP</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV_NAME</span>
            <span class="n">VENVSTRAPP</span> <span class="o">=</span> <span class="n">_APP</span>


        <span class="k">if</span> <span class="n">VIRTUAL_ENV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">VIRTUAL_ENV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">WORKON_HOME</span> <span class="ow">and</span> <span class="n">VIRTUAL_ENV_NAME</span><span class="p">:</span>
                    <span class="n">VIRTUAL_ENV</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">WORKON_HOME</span><span class="p">,</span> <span class="n">VIRTUAL_ENV_NAME</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VIRTUAL_ENV</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV</span>

        <span class="n">VENVPREFIX</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">VIRTUAL_ENV</span><span class="p">)</span>

        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">WORKON_HOME</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VENVSTR</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VENVSTRAPP</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_APP</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV_NAME</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VENVPREFIX</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VIRTUAL_ENV</span>

        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;parse_VENVSTR_output&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;env&#39;</span><span class="p">:</span> <span class="n">env</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span> <span class="p">})</span>

        <span class="c1">#import ipdb</span>
        <span class="c1"># ipdb.set_trace()</span>
        <span class="k">return</span> <span class="n">env</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            OrderedDict: self.env.aliases</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">aliases</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_configure_sys</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_environ</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pyver</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure ``sys.path`` with the given :py:mod:`Env`,</span>
<span class="sd">        or from ``os.environ``.</span>

<span class="sd">        Args:</span>
<span class="sd">            env (Env): Env to configure sys.path according to</span>
<span class="sd">                (default: None)</span>
<span class="sd">            from_environ (bool): whether to read Env from ``os.environ``</span>
<span class="sd">                (default: False)</span>
<span class="sd">            pyver (str): &quot;python2.7&quot; &quot;python3.4&quot; defaults to ``sys.platform``</span>

<span class="sd">        .. note:: This method adds</span>
<span class="sd">           ``/usr/local/python.ver.ver/dist-packages/IPython/extensions``</span>
<span class="sd">            to ``sys.path``</span>

<span class="sd">            Why? When working in a virtualenv which does not have</span>
<span class="sd">            an additional local copy of IPython installed,</span>
<span class="sd">            the lack of an extensions path was causing errors</span>
<span class="sd">            in regards to missing extensions.</span>

<span class="sd">            If the path does not exist, it will not be added.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">from_environ</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="o">.</span><span class="n">from_environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pyver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pyver</span> <span class="o">=</span> <span class="n">get_pyver</span><span class="p">()</span>

        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_PYLIB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_LIB&#39;</span><span class="p">],</span> <span class="n">pyver</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_PYSITE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_PYLIB&#39;</span><span class="p">],</span> <span class="s1">&#39;site-packages&#39;</span><span class="p">)</span>

        <span class="c1"># emulate virtualenv check for no-global-site-packages.txt</span>
        <span class="n">no_global_site_packages</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span>
            <span class="n">env</span><span class="p">(</span><span class="s1">&#39;_PYLIB&#39;</span><span class="p">),</span> <span class="s1">&#39;no-global-site-packages.txt&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">no_global_site_packages</span><span class="p">):</span>
            <span class="n">sys_libdir</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;/usr/lib&quot;</span><span class="p">,</span> <span class="n">pyver</span><span class="p">)</span>

            <span class="c1"># XXX: **OVERWRITE** sys.path</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">joinpath</span><span class="p">(</span><span class="n">sys_libdir</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;plat-linux2&quot;</span><span class="p">,</span> <span class="s2">&quot;lib-tk&quot;</span><span class="p">,</span> <span class="s2">&quot;lib-dynload&quot;</span><span class="p">)]</span>

            <span class="c1"># XXX: append /usr/local/lib/{pyver}/IPython/extensions # TODO?</span>
            <span class="n">ipython_extensions</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;/usr/local/lib/</span><span class="si">%s</span><span class="s1">/dist-packages/IPython/extensions&#39;</span>
                <span class="o">%</span> <span class="n">pyver</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ipython_extensions</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;IPython extensions not found: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                         <span class="n">ipython_extensions</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ipython_extensions</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ipython_extensions</span><span class="p">)</span>

        <span class="c1"># optimize_python_path(sys.path)</span>

        <span class="n">site</span><span class="o">.</span><span class="n">addsitedir</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_PYSITE&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">env</span>

<div class="viewcode-block" id="Venv.configure_sys"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.configure_sys">[docs]</a>    <span class="k">def</span> <span class="nf">configure_sys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: ``sys.path`` list from ``_configure_sys``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Venv</span><span class="o">.</span><span class="n">_configure_sys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="Venv.workon"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.workon">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">workon</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">VENVSTR</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">VENVSTRAPP</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            VENVSTR (str): a path to a virtualenv containing ``/``</span>
<span class="sd">                OR just the name of a virtualenv in ``$WORKON_HOME``</span>
<span class="sd">            VENVSTRAPP (str): e.g. ``dotfiles`` or ``dotfiles/docs``</span>
<span class="sd">            kwargs (dict): kwargs to pass to Venv (see ``Venv.__init__``)</span>
<span class="sd">        Returns:</span>
<span class="sd">            Venv: an intialized ``Venv``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">VENVSTR</span><span class="o">=</span><span class="n">VENVSTR</span><span class="p">,</span> <span class="n">VENVSTRAPP</span><span class="o">=</span><span class="n">VENVSTRAPP</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_configure_ipython</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">platform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">sympyprinting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">parallelmagic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">storemagic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">storemagic_autorestore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">autoreload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">deep_reload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>

                           <span class="n">venvaliases</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">usrlog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

                           <span class="n">venv_ipyconfig_debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>

                           <span class="n">setup_func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Configure IPython with ``autoreload=True``, ``deep_reload=True``,</span>
<span class="sd">        the **storemagic** extension, the **parallelmagic**</span>
<span class="sd">        extension if ``import zmq`` succeeds,</span>
<span class="sd">        and ``DEFAULT_ALIASES`` (``cd`` aliases are not currently working).</span>

<span class="sd">        Args:</span>
<span class="sd">            c (object): An IPython configuration object</span>
<span class="sd">                (``get_ipython()``)</span>
<span class="sd">            platform (str): platform string</span>
<span class="sd">                (``uname``: {&#39;Linux&#39;, &#39;Darwin&#39;})</span>

<span class="sd">                .. note:: If ``None``, ``platform`` is necessarily autodetected</span>
<span class="sd">                so that ``ps`` and ``ls`` aliases work with syntax coloring and</span>
<span class="sd">                Linux and OSX BSD coreutils.</span>

<span class="sd">            setup_func (function): a function to call with</span>
<span class="sd">                config as the first positional argument,</span>
<span class="sd">                **after** default configuration (default: ``None``)</span>

<span class="sd">        References:</span>

<span class="sd">            * http://ipython.org/ipython-doc/dev/config/</span>
<span class="sd">            * http://ipython.org/ipython-doc/dev/config/options/terminal.html</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">IN_IPYTHON_CONFIG</span><span class="p">:</span>
                <span class="c1"># skip IPython configuration</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;not in_venv_ipyconfig&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">IPYTHON_CONFIG</span> <span class="c1"># get_config()</span>

        <span class="k">if</span> <span class="n">venv_ipyconfig_debug</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span> <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>

        <span class="c1"># c.InteractiveShellApp.ignore_old_config = True</span>
        <span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="c1"># TODO: c.InteractiveShellApp.extensions.append?</span>
        <span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># &#39;autoreload&#39;,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">sympyprinting</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">sympy</span>
                <span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sympyprinting&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">parallelmagic</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">zmq</span>
                <span class="n">zmq</span>
                <span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;parallelmagic&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># c.InteractiveShell.autoreload = autoreload</span>
        <span class="n">c</span><span class="o">.</span><span class="n">InteractiveShell</span><span class="o">.</span><span class="n">deep_reload</span> <span class="o">=</span> <span class="n">deep_reload</span>

        <span class="k">if</span> <span class="n">storemagic</span><span class="p">:</span>
            <span class="c1"># %store [name]</span>
            <span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;storemagic&#39;</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">StoreMagic</span><span class="o">.</span><span class="n">autorestore</span> <span class="o">=</span> <span class="n">storemagic_autorestore</span>

        <span class="k">if</span> <span class="n">venvaliases</span><span class="p">:</span>
            <span class="n">ipython_default_aliases</span> <span class="o">=</span> <span class="n">get_IPYTHON_ALIAS_DEFAULTS</span><span class="p">(</span>
                <span class="n">platform</span><span class="o">=</span><span class="n">platform</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">AliasManager</span><span class="o">.</span><span class="n">default_aliases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ipython_default_aliases</span><span class="p">)</span>
            <span class="n">ipython_alias_overlay</span> <span class="o">=</span> <span class="n">get_IPYTHON_ALIAS_OVERLAY</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">AliasManager</span><span class="o">.</span><span class="n">default_aliases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ipython_alias_overlay</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">usrlog</span><span class="p">:</span>
            <span class="c1"># TODO: if kwargs.get(&#39;_USRLOG&#39;, kwargs.get(&#39;__USRLOG&#39;))</span>
            <span class="n">usrlog_alias_overlay</span> <span class="o">=</span> <span class="n">get_USRLOG_ALIAS_OVERLAY</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">AliasManager</span><span class="o">.</span><span class="n">default_aliases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">usrlog_alias_overlay</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">c</span>
        <span class="k">if</span> <span class="n">setup_func</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">setup_func</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="Venv.configure_ipython"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.configure_ipython">[docs]</a>    <span class="k">def</span> <span class="nf">configure_ipython</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure IPython with ``Venv._configure_ipython`` and</span>
<span class="sd">        ``user_aliases`` from ``self.aliases.items()``.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list): args for ``Venv._configure_ipython``</span>
<span class="sd">            kwargs (dict): kwargs for ``Venv._configure_ipython``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">setup_func</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">AliasManager</span><span class="o">.</span><span class="n">user_aliases</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">Venv</span><span class="o">.</span><span class="n">_configure_ipython</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">setup_func</span><span class="o">=</span><span class="n">setup_func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Venv.generate_vars_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.generate_vars_env">[docs]</a>    <span class="k">def</span> <span class="nf">generate_vars_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a string containing VARIABLE=&#39;./value&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">to_string_iter</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">block</span></div>

<div class="viewcode-block" id="Venv.generate_bash_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.generate_bash_env">[docs]</a>    <span class="k">def</span> <span class="nf">generate_bash_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">shell_keyword</span><span class="o">=</span><span class="s1">&#39;export &#39;</span><span class="p">,</span>
                          <span class="n">shell_quotefunc</span><span class="o">=</span><span class="n">shell_quote</span><span class="p">,</span>
                          <span class="n">include_paths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">include_aliases</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">include_cdaliases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a ``source``-able script for the environment variables,</span>
<span class="sd">        aliases, and functions defined by the current ``Venv``.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            shell_keyword (str): shell variable def (default: &quot;export &quot;)</span>
<span class="sd">            include_paths (bool): Include environ vars in output (default: True)</span>
<span class="sd">            include_aliases (bool): Include aliases in output (default: True)</span>
<span class="sd">            include_cdaliases (bool): Include cdaliases in output (default: False)</span>
<span class="sd">            compress_paths (bool): Compress paths to $VAR (default=False)</span>

<span class="sd">        Yields:</span>
<span class="sd">            str: block of bash script</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compress_paths</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;compress_paths&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_paths</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">iteritems_environ</span><span class="p">():</span>
                <span class="c1"># TODO: XXX:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">compress_paths</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">keyname</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="c1"># if _shell_supports_declare_g():</span>
                <span class="c1">#   shell_keyword=&quot;declare -grx &quot;</span>
                <span class="c1">#    yield &quot;declare -grx %s=%r&quot; % (k, v)</span>
                <span class="c1"># else:</span>
                <span class="c1">#     yield &quot;export %s=%r&quot; % (k, v</span>
                <span class="c1">#     yield(&quot;declare -r %k&quot; % k, file=output)</span>
                <span class="k">yield</span> <span class="s2">&quot;</span><span class="si">{keyword}{VAR}</span><span class="s2">=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">keyword</span><span class="o">=</span><span class="n">shell_keyword</span><span class="p">,</span>
                    <span class="n">VAR</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">shell_quotefunc</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">include_cdaliases</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">CdAlias</span><span class="o">.</span><span class="n">BASH_CDALIAS_HEADER</span>
        <span class="k">if</span> <span class="n">include_aliases</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">bash_alias</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;to_bash_function&#39;</span><span class="p">):</span>
                    <span class="n">bash_alias</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">to_bash_function</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;to_shell_str&#39;</span><span class="p">):</span>
                    <span class="n">bash_alias</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">to_shell_str</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_alias</span> <span class="o">=</span> <span class="n">IpyAlias</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                    <span class="n">bash_alias</span> <span class="o">=</span> <span class="n">_alias</span><span class="o">.</span><span class="n">to_shell_str</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">compress_paths</span><span class="p">:</span>
                    <span class="n">bash_alias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">(</span><span class="n">bash_alias</span><span class="p">,</span> <span class="n">keyname</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">bash_alias</span></div>

<div class="viewcode-block" id="Venv.generate_bash_cdalias"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.generate_bash_cdalias">[docs]</a>    <span class="k">def</span> <span class="nf">generate_bash_cdalias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a ``source``-able script for cdalias functions</span>

<span class="sd">        Yields:</span>
<span class="sd">            str: block of bash script</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="n">CdAlias</span><span class="o">.</span><span class="n">BASH_CDALIAS_HEADER</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">CdAlias</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">v</span><span class="o">.</span><span class="n">to_bash_function</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cdls&#39;</span><span class="p">,</span> <span class="s1">&#39;cdhelp&#39;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">IpyAlias</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">to_shell_str</span><span class="p">()</span></div>

<div class="viewcode-block" id="Venv.generate_vim_cdalias"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.generate_vim_cdalias">[docs]</a>    <span class="k">def</span> <span class="nf">generate_vim_cdalias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a ``source``-able vimscript for vim</span>

<span class="sd">        Yields:</span>
<span class="sd">            str: block of vim script</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">yield</span> <span class="n">CdAlias</span><span class="o">.</span><span class="n">VIM_HEADER_TEMPLATE</span>
        <span class="c1"># for k, v in self.env.items():</span>
        <span class="c1">#    yield (&quot;export %s=%r&quot; % (k, v))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;to_vim_function&#39;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">v</span><span class="o">.</span><span class="n">to_vim_function</span><span class="p">()</span></div>

<div class="viewcode-block" id="Venv.generate_venv_ipymagics"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.generate_venv_ipymagics">[docs]</a>    <span class="k">def</span> <span class="nf">generate_venv_ipymagics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate an ``venv_ipymagics.py`` file for IPython</span>

<span class="sd">        Yields:</span>
<span class="sd">            str: block of Python code</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">yield</span> <span class="n">CdAlias</span><span class="o">.</span><span class="n">VENV_IPYMAGICS_FILE_HEADER</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;to_ipython_method&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">to_ipython_method</span><span class="p">():</span>
                    <span class="k">yield</span> <span class="n">block</span>
        <span class="k">yield</span> <span class="n">CdAlias</span><span class="o">.</span><span class="n">VENV_IPYMAGICS_FOOTER</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">project_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_files</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_project_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;.rst&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default list of project files for ``_EDITCMD_``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of paths relative to ``$_WRD``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_project_files</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;README</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extension</span><span class="p">),</span>
            <span class="s1">&#39;CHANGELOG</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extension</span><span class="p">),</span>
            <span class="s1">&#39;Makefile&#39;</span><span class="p">,</span>
            <span class="s1">&#39;setup.py&#39;</span><span class="p">,</span>
            <span class="s1">&#39;requirements.txt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.git/config&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.gitignore&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.hg/hgrc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.hgignore&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;docs&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">default_project_files</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">PROJECT_FILES</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">PROJECT_FILES</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">shell_quote</span><span class="p">(</span><span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">],</span> <span class="n">fpath</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_files</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">PROJECT_FILES</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_edit_project_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Command to edit ``self.project_files``</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: ``$_EDIT_`` ``self.project_files``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_EDIT_&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROJECT_FILES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_terminal_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Command to open a terminal</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: env.get(&#39;TERMINAL&#39;) or ``/usr/bin/gnome-terminal``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: add Terminal.app</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TERMINAL&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr/bin/gnome-terminal&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_open_terminals_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Command to open ``self._terminal_cmd`` with a list of initial</span>
<span class="sd">        named terminals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: add Terminal.app (man Terminal.app?)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_terminal_cmd</span><span class="p">,</span>
            <span class="s1">&#39;--working-directory&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">],</span>

            <span class="s1">&#39;--tab&#39;</span><span class="p">,</span> <span class="s1">&#39;--title&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: bash&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span>
            <span class="s1">&#39;--command&#39;</span><span class="p">,</span> <span class="s1">&#39;bash&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--tab&#39;</span><span class="p">,</span> <span class="s1">&#39;--title&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: serve&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span>
            <span class="s1">&#39;--command&#39;</span><span class="p">,</span> <span class="s2">&quot;bash -c &#39;we </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&#39;; bash&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">]),</span>  <span class="c1">#</span>
            <span class="s1">&#39;--tab&#39;</span><span class="p">,</span> <span class="s1">&#39;--title&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: shell&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span>
            <span class="s1">&#39;--command&#39;</span><span class="p">,</span> <span class="s2">&quot;bash -c </span><span class="si">%r</span><span class="s2">; bash&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SHELL_&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cmd</span>

<div class="viewcode-block" id="Venv.system"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.system">[docs]</a>    <span class="k">def</span> <span class="nf">system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call ``os.system`` with the given command string</span>

<span class="sd">        Args:</span>
<span class="sd">            cmd (string): command string to call ``os.system`` with</span>
<span class="sd">        Raises:</span>
<span class="sd">            Exception: if ``cmd`` is None</span>
<span class="sd">            NotImplementedError: if ``cmd`` is a tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cmd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">_cmd</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="c1"># TODO: (subprocess.Popen)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,)):</span>
            <span class="n">_cmd</span> <span class="o">=</span> <span class="n">cmd</span>

            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">_cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Venv.open_editors"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.open_editors">[docs]</a>    <span class="k">def</span> <span class="nf">open_editors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run ``self._edit_project_cmd``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edit_project_cmd</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Venv.open_terminals"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.open_terminals">[docs]</a>    <span class="k">def</span> <span class="nf">open_terminals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run ``self._open_terminals_cmd``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_terminals_cmd</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="Venv.to_dict"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            OrderedDict: OrderedDict(env=self.env, aliases=self.aliases)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span></div>
        <span class="c1">#OrderedDict(</span>
            <span class="c1">#env=self.env,</span>
            <span class="c1">## aliases=self.aliases,</span>
        <span class="c1">#)</span>

<div class="viewcode-block" id="Venv.to_json"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.to_json">[docs]</a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            indent (int): number of spaces with which to indent JSON output</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: json.dumps(self.to_dict())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">VenvJSONEncoder</span><span class="p">)</span></div>

<div class="viewcode-block" id="Venv.update_os_environ"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.update_os_environ">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_os_environ</span><span class="p">(</span><span class="n">venv</span><span class="p">,</span> <span class="n">environ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update os.environ for the given venv</span>

<span class="sd">        Args:</span>
<span class="sd">            environ (dict): if None, defaults to os.environ</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: updated environ dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">environ</span> <span class="o">=</span> <span class="n">environ</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
        <span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">environ</span></div>

<div class="viewcode-block" id="Venv.call"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Venv.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            command (str): command to run</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: output from subprocess.call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_os_environ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">VENVPREFIX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">VENVPREFIX</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigException</span><span class="p">(</span><span class="s2">&quot;VENVPREFIX is None&quot;</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="n">command</span><span class="p">,</span>
            <span class="s1">&#39;shell&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="c1">#&#39;env&#39;: env,</span>
            <span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">:</span> <span class="n">VENVPREFIX</span><span class="p">,</span>
            <span class="s1">&#39;cwd&#39;</span><span class="p">:</span> <span class="n">VENVPREFIX</span><span class="p">}</span>
        <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;subprocess.call&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; #venv.call&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="get_IPYTHON_ALIAS_DEFAULTS"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.get_IPYTHON_ALIAS_DEFAULTS">[docs]</a><span class="k">def</span> <span class="nf">get_IPYTHON_ALIAS_DEFAULTS</span><span class="p">(</span><span class="n">platform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">platform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>

    <span class="n">IS_DARWIN</span> <span class="o">=</span> <span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span>

    <span class="n">LS_COLOR_AUTO</span> <span class="o">=</span> <span class="s2">&quot;--color=auto&quot;</span>
    <span class="k">if</span> <span class="n">IS_DARWIN</span><span class="p">:</span>
        <span class="n">LS_COLOR_AUTO</span> <span class="o">=</span> <span class="s2">&quot;-G&quot;</span>

    <span class="n">PSX_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;ps uxaw&#39;</span>
    <span class="n">PSF_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;ps uxawf&#39;</span>
    <span class="n">PS_SORT_CPU</span> <span class="o">=</span> <span class="s1">&#39;--sort=-pcpu&#39;</span>
    <span class="n">PS_SORT_MEM</span> <span class="o">=</span> <span class="s1">&#39;--sort=-pmem&#39;</span>
    <span class="k">if</span> <span class="n">IS_DARWIN</span><span class="p">:</span>
        <span class="n">PSX_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;ps uxaw&#39;</span>
        <span class="n">PSF_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;ps uxaw&#39;</span>
        <span class="n">PS_SORT_CPU</span> <span class="o">=</span> <span class="s1">&#39;-c&#39;</span>
        <span class="n">PS_SORT_MEM</span> <span class="o">=</span> <span class="s1">&#39;-m&#39;</span>

    <span class="n">DEFAULT_ALIASES</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span>
        <span class="p">(</span><span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="s1">&#39;bash&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;chmodr&#39;</span><span class="p">,</span> <span class="s1">&#39;chmod -R&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;chownr&#39;</span><span class="p">,</span> <span class="s1">&#39;chown -R&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;egrep&#39;</span><span class="p">,</span> <span class="s1">&#39;egrep --color=auto&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;fgrep&#39;</span><span class="p">,</span> <span class="s1">&#39;fgrep --color=auto&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;git&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ga&#39;</span><span class="p">,</span> <span class="s1">&#39;git add&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;gd&#39;</span><span class="p">,</span> <span class="s1">&#39;git diff&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;gdc&#39;</span><span class="p">,</span> <span class="s1">&#39;git diff --cached&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;gs&#39;</span><span class="p">,</span> <span class="s1">&#39;git status&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;gl&#39;</span><span class="p">,</span> <span class="s1">&#39;git log&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;grep&#39;</span><span class="p">,</span> <span class="s1">&#39;grep --color=auto&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;grin&#39;</span><span class="p">,</span> <span class="s1">&#39;grin&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;grind&#39;</span><span class="p">,</span> <span class="s1">&#39;grind&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;grinpath&#39;</span><span class="p">,</span> <span class="s1">&#39;grin --sys-path&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;grindpath&#39;</span><span class="p">,</span> <span class="s1">&#39;grind --sys-path&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;grunt&#39;</span><span class="p">,</span> <span class="s1">&#39;grunt&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;gvim&#39;</span><span class="p">,</span> <span class="s1">&#39;gvim&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">,</span> <span class="s1">&#39;head&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;hg&#39;</span><span class="p">,</span> <span class="s1">&#39;hg&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;hgl&#39;</span><span class="p">,</span> <span class="s1">&#39;hg log -l10&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;hgs&#39;</span><span class="p">,</span> <span class="s1">&#39;hg status&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;htop&#39;</span><span class="p">,</span> <span class="s1">&#39;htop&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ifconfig&#39;</span><span class="p">,</span> <span class="s1">&#39;ifconfig&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ip&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;la&#39;</span><span class="p">,</span> <span class="s1">&#39;ls </span><span class="si">{}</span><span class="s1"> -A&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LS_COLOR_AUTO</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;ll&#39;</span><span class="p">,</span> <span class="s1">&#39;ls </span><span class="si">{}</span><span class="s1"> -al&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LS_COLOR_AUTO</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">,</span> <span class="s1">&#39;ls </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LS_COLOR_AUTO</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span> <span class="s1">&#39;ls </span><span class="si">{}</span><span class="s1"> -altr&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LS_COLOR_AUTO</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;lll&#39;</span><span class="p">,</span> <span class="s1">&#39;ls </span><span class="si">{}</span><span class="s1"> -altr&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LS_COLOR_AUTO</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;lz&#39;</span><span class="p">,</span> <span class="s1">&#39;ls </span><span class="si">{}</span><span class="s1"> -alZ&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LS_COLOR_AUTO</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;lxc&#39;</span><span class="p">,</span> <span class="s1">&#39;lxc&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;make&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;mkdir&#39;</span><span class="p">,</span> <span class="s1">&#39;mkdir&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;netstat&#39;</span><span class="p">,</span> <span class="s1">&#39;netstat&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;nslookup&#39;</span><span class="p">,</span> <span class="s1">&#39;nslookup&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;ping&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;psf&#39;</span><span class="p">,</span> <span class="n">PSF_COMMAND</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;psx&#39;</span><span class="p">,</span> <span class="n">PSX_COMMAND</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;psh&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> | head&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PSX_COMMAND</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;psc&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PSX_COMMAND</span><span class="p">,</span> <span class="n">PS_SORT_CPU</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;psch&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> | head&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PSX_COMMAND</span><span class="p">,</span> <span class="n">PS_SORT_CPU</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;psm&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PSX_COMMAND</span><span class="p">,</span> <span class="n">PS_SORT_MEM</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;psmh&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> | head&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PSX_COMMAND</span><span class="p">,</span> <span class="n">PS_SORT_MEM</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;psfx&#39;</span><span class="p">,</span> <span class="n">PSF_COMMAND</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;pydoc&#39;</span><span class="p">,</span> <span class="s1">&#39;pydoc&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;pyline&#39;</span><span class="p">,</span> <span class="s1">&#39;pyline&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;pyrpo&#39;</span><span class="p">,</span> <span class="s1">&#39;pyrpo&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="s1">&#39;route&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;rm&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;rsync&#39;</span><span class="p">,</span> <span class="s1">&#39;rsync&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ss&#39;</span><span class="p">,</span> <span class="s1">&#39;ss&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ssv&#39;</span><span class="p">,</span> <span class="s1">&#39;supervisord&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="s1">&#39;stat&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;sudo&#39;</span><span class="p">,</span> <span class="s1">&#39;sudo&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;sv&#39;</span><span class="p">,</span> <span class="s1">&#39;supervisorctl&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;tail -f&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="s1">&#39;tail&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;thg&#39;</span><span class="p">,</span> <span class="s1">&#39;thg&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;tracepath&#39;</span><span class="p">,</span> <span class="s1">&#39;tracepath&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;tracepath6&#39;</span><span class="p">,</span> <span class="s1">&#39;tracepath6&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;vim&#39;</span><span class="p">,</span> <span class="s1">&#39;vim&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;uptime&#39;</span><span class="p">,</span> <span class="s1">&#39;uptime&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;which&#39;</span><span class="p">,</span> <span class="s1">&#39;which&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;who_&#39;</span><span class="p">,</span> <span class="s1">&#39;who&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">,</span> <span class="s1">&#39;whoami&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;zsh&#39;</span><span class="p">,</span> <span class="s1">&#39;zsh&#39;</span><span class="p">),</span>
    <span class="p">))</span>

    <span class="k">return</span> <span class="n">DEFAULT_ALIASES</span></div>


<div class="viewcode-block" id="get_IPYTHON_ALIAS_OVERLAY"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.get_IPYTHON_ALIAS_OVERLAY">[docs]</a><span class="k">def</span> <span class="nf">get_IPYTHON_ALIAS_OVERLAY</span><span class="p">():</span>
    <span class="n">IPYTHON_ALIAS_OVERLAY</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;pydoc&#39;</span><span class="p">,</span> <span class="s1">&#39;pydoc %l | cat&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;pip&#39;</span><span class="p">,</span> <span class="s1">&#39;pip&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;dotf&#39;</span><span class="p">,</span> <span class="s1">&#39;dotf&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;venv&#39;</span><span class="p">,</span> <span class="s1">&#39;venv&#39;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">IPYTHON_ALIAS_OVERLAY</span></div>


<div class="viewcode-block" id="get_USRLOG_ALIAS_OVERLAY"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.get_USRLOG_ALIAS_OVERLAY">[docs]</a><span class="k">def</span> <span class="nf">get_USRLOG_ALIAS_OVERLAY</span><span class="p">():</span>
    <span class="n">USRLOG_ALIAS_OVERLAY</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;ut&#39;</span><span class="p">,</span> <span class="s1">&#39;tail $$_USRLOG&#39;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">USRLOG_ALIAS_OVERLAY</span></div>



<div class="viewcode-block" id="ipython_main"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.ipython_main">[docs]</a><span class="k">def</span> <span class="nf">ipython_main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configure IPython with :py:class:`Venv`</span>
<span class="sd">    :py:method:`configure_ipython`</span>
<span class="sd">    (:py:method:`_configure_ipython`).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">venv</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s1">&#39;VIRTUAL_ENV&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">(</span><span class="n">from_environ</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">venv</span><span class="o">.</span><span class="n">configure_ipython</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Venv</span><span class="o">.</span><span class="n">_configure_ipython</span><span class="p">()</span></div>


<div class="viewcode-block" id="ipython_imports"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.ipython_imports">[docs]</a><span class="k">def</span> <span class="nf">ipython_imports</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Default imports for IPython (currently unused)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">IPython.external.path</span> <span class="k">import</span> <span class="n">path</span>
    <span class="n">path</span>
    <span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>
    <span class="n">pp</span>
    <span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pformat</span> <span class="k">as</span> <span class="n">pf</span>
    <span class="n">pf</span>
    <span class="kn">import</span> <span class="nn">json</span>

    <span class="k">def</span> <span class="nf">ppd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span></div>

<span class="c1"># Tests</span>


<div class="viewcode-block" id="VenvTestUtils"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.VenvTestUtils">[docs]</a><span class="k">class</span> <span class="nc">VenvTestUtils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test fixtures for TestCases and examples</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="VenvTestUtils.build_env_test_fixture"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.VenvTestUtils.build_env_test_fixture">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">build_env_test_fixture</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                               <span class="n">get___WRK_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>
                                     <span class="n">get_WORKON_HOME_default</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;dotfiles&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>
                                    <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">,</span>
                              <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>
                                <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]))</span>  <span class="c1"># TODO || basename(VENVPREFIX)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span>
                                          <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                                              <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span>
                                     <span class="n">joinpath</span><span class="p">(</span>
                                         <span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">],</span>
                                         <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">]))</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">],</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">],</span> <span class="s1">&#39;etc&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">joinpath</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">env</span></div>

<div class="viewcode-block" id="VenvTestUtils.capture_io"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.VenvTestUtils.capture_io">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">capture_io</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add stdout and sterr kwargs to a function call</span>
<span class="sd">        and return (output, _stdout, _stderr)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__capture_io</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># ... partial/wraps</span>
            <span class="n">_stdout</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">())</span>
            <span class="n">_stderr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">StringIO</span><span class="p">())</span>
            <span class="n">ioconf</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stdout&quot;</span><span class="p">:</span> <span class="n">_stdout</span><span class="p">,</span> <span class="s2">&quot;stderr&quot;</span><span class="p">:</span> <span class="n">_stderr</span><span class="p">}</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ioconf</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># _stdout.seek(0), _stderr.seek(0)</span>
            <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">_stdout</span><span class="p">,</span> <span class="n">_stderr</span>
        <span class="k">return</span> <span class="n">__capture_io</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">_TestCase</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_TestCase</span> <span class="o">=</span> <span class="nb">object</span>


<div class="viewcode-block" id="VenvTestCase"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.VenvTestCase">[docs]</a><span class="k">class</span> <span class="nc">VenvTestCase</span><span class="p">(</span><span class="n">_TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;unittest.TestCase or object&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Test_001_lookup"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_001_lookup">[docs]</a><span class="k">class</span> <span class="nc">Test_001_lookup</span><span class="p">(</span><span class="n">VenvTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="Test_001_lookup.test_100_lookup"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_001_lookup.test_100_lookup">[docs]</a>    <span class="k">def</span> <span class="nf">test_100_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;True&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;envTrue&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="s1">&#39;isNone&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;kwargsTrue&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="s1">&#39;collide&#39;</span><span class="p">:</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">}</span>
        <span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;True&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;envTrue&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s1">&#39;isNone&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;envNone&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
               <span class="s1">&#39;collide&#39;</span><span class="p">:</span> <span class="s1">&#39;env&#39;</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lookup_from_kwargs_env</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;kwargsTrue&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;envTrue&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;collide&#39;</span><span class="p">),</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="Test_100_Env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_100_Env">[docs]</a><span class="k">class</span> <span class="nc">Test_100_Env</span><span class="p">(</span><span class="n">VenvTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="Test_100_Env.test_010_Env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_100_Env.test_010_Env">[docs]</a>    <span class="k">def</span> <span class="nf">test_010_Env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;WORKON_HOME&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span>
        <span class="n">e</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;~/-wrk/-ve27&#39;</span>
        <span class="k">assert</span> <span class="s1">&#39;WORKON_HOME&#39;</span> <span class="ow">in</span> <span class="n">e</span>
        <span class="k">assert</span> <span class="s1">&#39;WORKON_HOME&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">environ</span></div>

<div class="viewcode-block" id="Test_100_Env.test_020_Env_copy"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_100_Env.test_020_Env_copy">[docs]</a>    <span class="k">def</span> <span class="nf">test_020_Env_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
        <span class="n">keyname</span> <span class="o">=</span> <span class="s1">&#39;_test&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">keyname</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">e</span><span class="p">[</span><span class="n">keyname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">keyname</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">keyname</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>

        <span class="n">keyname</span> <span class="o">=</span> <span class="s1">&#39;_test2&#39;</span>
        <span class="n">e2</span><span class="p">[</span><span class="n">keyname</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">keyname</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">keyname</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_100_Env.test_Env_from_environ"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_100_Env.test_Env_from_environ">[docs]</a>    <span class="k">def</span> <span class="nf">test_Env_from_environ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">Env</span><span class="o">.</span><span class="n">from_environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Test_200_StepBuilder"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_200_StepBuilder">[docs]</a><span class="k">class</span> <span class="nc">Test_200_StepBuilder</span><span class="p">(</span><span class="n">VenvTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="Test_200_StepBuilder.test_000_Step"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_200_StepBuilder.test_000_Step">[docs]</a>    <span class="k">def</span> <span class="nf">test_000_Step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">build_func</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">env</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Step</span><span class="p">(</span><span class="n">build_func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_200_StepBuilder.test_500_StepBuilder"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_200_StepBuilder.test_500_StepBuilder">[docs]</a>    <span class="k">def</span> <span class="nf">test_500_StepBuilder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">StepBuilder</span><span class="p">()</span>
        <span class="n">step</span><span class="p">,</span> <span class="n">new_env</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">new_env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">new_env</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="n">StepBuilder</span><span class="p">()</span>
        <span class="n">step</span><span class="p">,</span> <span class="n">new_env</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">new_env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">new_env</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_200_StepBuilder.test_600_StepBuilder"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_200_StepBuilder.test_600_StepBuilder">[docs]</a>    <span class="k">def</span> <span class="nf">test_600_StepBuilder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;_test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="n">StepBuilder</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">PrintEnvStderrStep</span><span class="p">)</span>
        <span class="n">step</span><span class="p">,</span> <span class="n">new_env</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">new_env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">new_env</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Test_250_Venv"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_250_Venv">[docs]</a><span class="k">class</span> <span class="nc">Test_250_Venv</span><span class="p">(</span><span class="n">VenvTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="Test_250_Venv.setUp"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_250_Venv.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">VenvTestUtils</span><span class="o">.</span><span class="n">build_env_test_fixture</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">envattrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;_APP&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span> <span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span> <span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Test_250_Venv.test_000_venv_test_fixture"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_250_Venv.test_000_venv_test_fixture">[docs]</a>    <span class="k">def</span> <span class="nf">test_000_venv_test_fixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">envattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span></div>

<div class="viewcode-block" id="Test_250_Venv.test_010_assert_venv_requires_VENVPREFIX__or__VIRTUAL_ENV"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_250_Venv.test_010_assert_venv_requires_VENVPREFIX__or__VIRTUAL_ENV">[docs]</a>    <span class="k">def</span> <span class="nf">test_010_assert_venv_requires_VENVPREFIX__or__VIRTUAL_ENV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">()</span></div>

<div class="viewcode-block" id="Test_250_Venv.test_100_Venv_parse_VENVSTR_env__and__VENVSTR"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_250_Venv.test_100_Venv_parse_VENVSTR_env__and__VENVSTR">[docs]</a>    <span class="k">def</span> <span class="nf">test_100_Venv_parse_VENVSTR_env__and__VENVSTR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Venv</span><span class="o">.</span><span class="n">parse_VENVSTR</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">envattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">test_110_Venv_parse_VENVSTR_VENVSTR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Venv</span><span class="o">.</span><span class="n">parse_VENVSTR</span><span class="p">(</span><span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">envattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">raise</span>

<div class="viewcode-block" id="Test_250_Venv.test_110_Venv_parse_VENVSTR_VENVSTR"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_250_Venv.test_110_Venv_parse_VENVSTR_VENVSTR">[docs]</a>    <span class="k">def</span> <span class="nf">test_110_Venv_parse_VENVSTR_VENVSTR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Venv</span><span class="o">.</span><span class="n">parse_VENVSTR</span><span class="p">(</span><span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">envattrs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">attr</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">raise</span></div>

<div class="viewcode-block" id="Test_250_Venv.test_120_Venv_parse_VENVSTR_VENVSTR_VENVSTRAPP"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_250_Venv.test_120_Venv_parse_VENVSTR_VENVSTR_VENVSTRAPP">[docs]</a>    <span class="k">def</span> <span class="nf">test_120_Venv_parse_VENVSTR_VENVSTR_VENVSTRAPP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">VENVSTRAPP</span> <span class="o">=</span> <span class="s1">&#39;dotfiles/docs&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">VenvTestUtils</span><span class="o">.</span><span class="n">build_env_test_fixture</span><span class="p">(</span>
            <span class="n">Env</span><span class="p">(</span><span class="n">VENVSTRAPP</span><span class="o">=</span><span class="n">VENVSTRAPP</span><span class="p">,</span> <span class="n">_APP</span><span class="o">=</span><span class="n">VENVSTRAPP</span><span class="p">))</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Venv</span><span class="o">.</span><span class="n">parse_VENVSTR</span><span class="p">(</span><span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">],</span>
                                  <span class="n">VENVSTRAPP</span><span class="o">=</span><span class="n">VENVSTRAPP</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">envattrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span> <span class="n">VENVSTRAPP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">],</span> <span class="n">VENVSTRAPP</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Test_300_venv_build_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env">[docs]</a><span class="k">class</span> <span class="nc">Test_300_venv_build_env</span><span class="p">(</span><span class="n">VenvTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    test each build step independently</span>

<span class="sd">    .. code:: python</span>

<span class="sd">        kwargs = {}</span>
<span class="sd">        env = env.copy()</span>
<span class="sd">        buildfunc = build_virtualenvwrapper_env</span>
<span class="sd">        new_env = buildfunc(env=env, **kwargs)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Test_300_venv_build_env.setUp"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">VenvTestUtils</span><span class="o">.</span><span class="n">build_env_test_fixture</span><span class="p">()</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.print_"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.print_">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">print_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_100_build_dotfiles_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_100_build_dotfiles_env">[docs]</a>    <span class="k">def</span> <span class="nf">test_100_build_dotfiles_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_dotfiles_env</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_200_build_usrlog_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_200_build_usrlog_env">[docs]</a>    <span class="k">def</span> <span class="nf">test_200_build_usrlog_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_usrlog_env</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_400_build_virtualenvwrapper_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_400_build_virtualenvwrapper_env">[docs]</a>    <span class="k">def</span> <span class="nf">test_400_build_virtualenvwrapper_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_virtualenvwrapper_env</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_500_build_conda_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_500_build_conda_env">[docs]</a>    <span class="k">def</span> <span class="nf">test_500_build_conda_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_conda_env</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_600_build_conda_cfg_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_600_build_conda_cfg_env">[docs]</a>    <span class="k">def</span> <span class="nf">test_600_build_conda_cfg_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_conda_cfg_env</span><span class="p">()</span>
        <span class="c1">#env = build_conda_cfg_env(env=env, conda_root=None, conda_home=None)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_600_build_venv_paths_full_env__prefix_None"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_600_build_venv_paths_full_env__prefix_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_600_build_venv_paths_full_env__prefix_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ConfigException</span><span class="p">):</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">build_venv_paths_full_env</span><span class="p">()</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_610_build_venv_paths_full_env__prefix_root"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_610_build_venv_paths_full_env__prefix_root">[docs]</a>    <span class="k">def</span> <span class="nf">test_610_build_venv_paths_full_env__prefix_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_venv_paths_full_env</span><span class="p">(</span><span class="n">VENVPREFIX</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_BIN&#39;</span><span class="p">],</span> <span class="s1">&#39;/bin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_ETC&#39;</span><span class="p">],</span> <span class="s1">&#39;/etc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">],</span> <span class="s1">&#39;/src&#39;</span><span class="p">)</span>  <span class="c1"># TODO</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_LOG&#39;</span><span class="p">],</span> <span class="s1">&#39;/var/log&#39;</span><span class="p">)</span></div>
        <span class="c1"># self.assertIn(&#39;WORKON_HOME&#39;, env)</span>

<div class="viewcode-block" id="Test_300_venv_build_env.test_620_build_venv_paths_full_env__prefix_None"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_620_build_venv_paths_full_env__prefix_None">[docs]</a>    <span class="k">def</span> <span class="nf">test_620_build_venv_paths_full_env__prefix_None</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_venv_activate_env</span><span class="p">(</span><span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;VENVSTR&quot;</span><span class="p">])</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_venv_paths_full_env</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;VIRTUAL_ENV&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;VIRTUAL_ENV&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Test_300_venv_build_env.test_650_build_venv_paths_cdalias_env"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_300_venv_build_env.test_650_build_venv_paths_cdalias_env">[docs]</a>    <span class="k">def</span> <span class="nf">test_650_build_venv_paths_cdalias_env</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">build_venv_paths_cdalias_env</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">env</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Test_500_Venv"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv">[docs]</a><span class="k">class</span> <span class="nc">Test_500_Venv</span><span class="p">(</span><span class="n">VenvTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="Test_500_Venv.setUp"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">VenvTestUtils</span><span class="o">.</span><span class="n">build_env_test_fixture</span><span class="p">()</span></div>

<div class="viewcode-block" id="Test_500_Venv.test_000_venv"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.test_000_venv">[docs]</a>    <span class="k">def</span> <span class="nf">test_000_venv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span> <span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;_APP&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">()</span></div>

<div class="viewcode-block" id="Test_500_Venv.test_005_venv"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.test_005_venv">[docs]</a>    <span class="k">def</span> <span class="nf">test_005_venv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">(</span><span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">venv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;_APP&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span></div>

<div class="viewcode-block" id="Test_500_Venv.test_010_venv__APP"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.test_010_venv__APP">[docs]</a>    <span class="k">def</span> <span class="nf">test_010_venv__APP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">(</span><span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span> <span class="n">_APP</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">,</span> <span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Test_500_Venv.test_011_venv__APP"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.test_011_venv__APP">[docs]</a>    <span class="k">def</span> <span class="nf">test_011_venv__APP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">_APP</span> <span class="o">=</span> <span class="s2">&quot;dotfiles/docs&quot;</span>
        <span class="n">VENVSTRAPP</span> <span class="o">=</span> <span class="s2">&quot;dotfiles/docs&quot;</span>

        <span class="n">_env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">(</span><span class="n">_APP</span><span class="o">=</span><span class="n">_APP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">_env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span> <span class="n">_APP</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">VenvTestUtils</span><span class="o">.</span><span class="n">build_env_test_fixture</span><span class="p">(</span><span class="n">_env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span> <span class="n">_APP</span><span class="p">)</span>

        <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">(</span><span class="n">VENVSTR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span>
                    <span class="n">_APP</span><span class="o">=</span><span class="n">_APP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;_APP&#39;</span><span class="p">,</span> <span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">],</span>
                         <span class="n">joinpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_SRC&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Test_500_Venv.test_020_venv_from_null_environ"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.test_020_venv_from_null_environ">[docs]</a>    <span class="k">def</span> <span class="nf">test_020_venv_from_null_environ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">Venv</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_500_Venv.test_030_venv_without_environ"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.test_030_venv_without_environ">[docs]</a>    <span class="k">def</span> <span class="nf">test_030_venv_without_environ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">StepConfigException</span><span class="p">):</span>
            <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">()</span></div>

    <span class="c1"># Errors w/ travis: TODO XXX FIXME</span>
    <span class="c1">#def test_040_venv_with_environ(self):</span>
        <span class="c1">#os.environ[&#39;VIRTUAL_ENV&#39;] = self.env[&#39;VIRTUAL_ENV&#39;]</span>
        <span class="c1">#venv = Venv(from_environ=True)</span>
        <span class="c1">#self.assertTrue(venv)</span>
        <span class="c1">#self.assertEqual(venv.env[&#39;VIRTUAL_ENV&#39;], self.env[&#39;VIRTUAL_ENV&#39;])</span>

<div class="viewcode-block" id="Test_500_Venv.test_050_venv__VENVSTR__WORKON_HOME"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_500_Venv.test_050_venv__VENVSTR__WORKON_HOME">[docs]</a>    <span class="k">def</span> <span class="nf">test_050_venv__VENVSTR__WORKON_HOME</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">WORKON_HOME</span> <span class="o">=</span> <span class="s1">&#39;/WRKON_HOME&#39;</span>
        <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">],</span> <span class="n">WORKON_HOME</span><span class="o">=</span><span class="n">WORKON_HOME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">venv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">],</span> <span class="n">WORKON_HOME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_WRD&#39;</span><span class="p">],</span>
                         <span class="n">joinpath</span><span class="p">(</span><span class="n">WORKON_HOME</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">],</span>
                                  <span class="s1">&#39;src&#39;</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]))</span></div></div>

    <span class="c1"># TODO</span>
    <span class="c1"># def test_060_venv__VENVSTR__WRK(self):</span>
        <span class="c1">#__WRK = &#39;/WRRK&#39;</span>
        <span class="c1">#venv = Venv(VENVSTR=self.env[&#39;VENVSTR&#39;], __WRK=__WRK)</span>
        <span class="c1"># self.assertTrue(venv)</span>
        <span class="c1">#self.assertEqual(venv.env[&#39;__WRK&#39;], __WRK)</span>
        <span class="c1"># self.assertEqual(venv.env[&#39;_WRD&#39;],</span>
                         <span class="c1"># joinpath(__WRK,</span>
                                  <span class="c1">#&#39;-ve27&#39;,</span>
                                  <span class="c1"># self.env[&#39;VIRTUAL_ENV_NAME&#39;],</span>
                                  <span class="c1">#&#39;src&#39;,</span>
                                  <span class="c1"># self.env[&#39;VENVSTR&#39;]))</span>


<div class="viewcode-block" id="Test_900_Venv_main"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main">[docs]</a><span class="k">class</span> <span class="nc">Test_900_Venv_main</span><span class="p">(</span><span class="n">VenvTestCase</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="Test_900_Venv_main.setUp"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">VenvTestUtils</span><span class="o">.</span><span class="n">build_env_test_fixture</span><span class="p">()</span>
        <span class="c1"># wrap main as self.main on setup to always capture IO</span>
        <span class="c1"># (output, stdout, stderr)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">VenvTestUtils</span><span class="o">.</span><span class="n">capture_io</span><span class="p">(</span><span class="n">main</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_001_main_null"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_001_main_null">[docs]</a>    <span class="k">def</span> <span class="nf">test_001_main_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#with self.assertRaises(SystemExit):</span>
        <span class="c1">#    retcode, stdout, stderr = self.main()</span>
        <span class="c1">#    self.assertEqual(retcode, 0)</span>
        <span class="k">pass</span></div>

    <span class="c1"># calls SystemExit</span>
    <span class="c1"># def test_002_main_help(self):</span>
    <span class="c1">#    retcode, stdout, stderr = self.main(&#39;-h&#39;)</span>
    <span class="c1">#    self.assertEqual(retcode, 0)</span>
    <span class="c1">#    retcode, stdout, stderr = self.main(&#39;--help&#39;)</span>
    <span class="c1">#    self.assertEqual(retcode, 0)</span>

<div class="viewcode-block" id="Test_900_Venv_main.test_100_main"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_100_main">[docs]</a>    <span class="k">def</span> <span class="nf">test_100_main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
            <span class="s1">&#39;--VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">],</span>
            <span class="s1">&#39;--APP&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
            <span class="s1">&#39;--ve&#39;</span><span class="p">,</span> <span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--app&#39;</span><span class="p">,</span> <span class="s1">&#39;dotfiles&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_110_main_VENVSTR"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_110_main_VENVSTR">[docs]</a>    <span class="k">def</span> <span class="nf">test_110_main_VENVSTR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_120_main_print_bash_VENVSTR"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_120_main_print_bash_VENVSTR">[docs]</a>    <span class="k">def</span> <span class="nf">test_120_main_print_bash_VENVSTR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
            <span class="s1">&#39;--print-vars&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
            <span class="s1">&#39;--print-vars&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--compress&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_130_main_print_bash_VENVSTR_VENVSTRAPP"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_130_main_print_bash_VENVSTR_VENVSTRAPP">[docs]</a>    <span class="k">def</span> <span class="nf">test_130_main_print_bash_VENVSTR_VENVSTRAPP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
            <span class="s1">&#39;--print-vars&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_140_main_VENVSTR_WORKON_HOME"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_140_main_VENVSTR_WORKON_HOME">[docs]</a>    <span class="k">def</span> <span class="nf">test_140_main_VENVSTR_WORKON_HOME</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;--print-vars&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--WORKON_HOME&#39;</span><span class="p">,</span> <span class="s1">&#39;/WORKON_HOME&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_200_main_print_bash_VENVSTR__APP"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_200_main_print_bash_VENVSTR__APP">[docs]</a>    <span class="k">def</span> <span class="nf">test_200_main_print_bash_VENVSTR__APP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
            <span class="s1">&#39;--print-bash&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;_APP&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_200_main_print_bash"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_200_main_print_bash">[docs]</a>    <span class="k">def</span> <span class="nf">test_200_main_print_bash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span> <span class="s1">&#39;--print-bash&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_210_main_print_bash_aliases"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_210_main_print_bash_aliases">[docs]</a>    <span class="k">def</span> <span class="nf">test_210_main_print_bash_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span> <span class="s1">&#39;--print-bash-aliases&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_220_main_print_bash_cdaliases"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_220_main_print_bash_cdaliases">[docs]</a>    <span class="k">def</span> <span class="nf">test_220_main_print_bash_cdaliases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span> <span class="s1">&#39;--print-bash-cdaliases&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">test_300_main_print_zsh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span> <span class="s1">&#39;--print-zsh&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="Test_900_Venv_main.test_300_main_print_zsh"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_300_main_print_zsh">[docs]</a>    <span class="k">def</span> <span class="nf">test_300_main_print_zsh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span> <span class="s1">&#39;--print-zsh-cdalias&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Test_900_Venv_main.test_400_main_print_vim"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.Test_900_Venv_main.test_400_main_print_vim">[docs]</a>    <span class="k">def</span> <span class="nf">test_400_main_print_vim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retcode</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span> <span class="s1">&#39;--print-vim-cdalias&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">retcode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div></div>

<span class="c1"># optparse.OptionParser</span>


<div class="viewcode-block" id="build_venv_arg_parser"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.build_venv_arg_parser">[docs]</a><span class="k">def</span> <span class="nf">build_venv_arg_parser</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        optparse.OptionParser: options for the commandline interface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">argparse</span>

    <span class="n">stdargs</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">prs</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">prog</span><span class="o">=</span><span class="s2">&quot;venv&quot;</span><span class="p">,</span>
        <span class="c1">#usage=(&quot;%prog [-b|--print-bash] [-t] [-e] [-E&lt;virtualenv&gt;] [appname]&quot;),</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;venv is a configuration utility for virtual environments.&quot;</span><span class="p">),</span>
        <span class="n">epilog</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;argparse.REMAINDER: &quot;</span>
            <span class="s2">&quot;If args must be specified, either (VENVSTR AND VENVSTRAPP) &quot;</span>
            <span class="s2">&quot;or (--ve [--app]) &quot;</span>
            <span class="s2">&quot;must be specified first: venv --ve dotfiles -xmake.&quot;</span><span class="p">),</span>
        <span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">stdargs</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">stdprs</span> <span class="o">=</span> <span class="n">prs</span>
    <span class="n">stdprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-V&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,)</span>
    <span class="n">stdprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--verbose&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append_const&#39;</span><span class="p">,</span>
                     <span class="n">const</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">stdprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-D&#39;</span><span class="p">,</span> <span class="s1">&#39;--diff&#39;</span><span class="p">,</span> <span class="s1">&#39;--show-diffs&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;show_diffs&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,)</span>
    <span class="n">stdprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-T&#39;</span><span class="p">,</span> <span class="s1">&#39;--trace&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;trace&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,)</span>
    <span class="n">stdprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-q&#39;</span><span class="p">,</span> <span class="s1">&#39;--quiet&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;quiet&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,)</span>
    <span class="n">stdprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;--test&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;run_tests&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--platform&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Platform string (default: None)&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;platform&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="p">)</span>


    <span class="n">envprs</span> <span class="o">=</span> <span class="n">prs</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;--from-environ&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Build venv.env.environ from keys in os.environ&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;from_environ&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--__WRK&#39;</span><span class="p">,</span> <span class="s1">&#39;--WRK&#39;</span><span class="p">,</span> <span class="s1">&#39;--wrk&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to workspace -- ~/-wrk&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--__DOTFILES&#39;</span><span class="p">,</span> <span class="s1">&#39;--DOTFILES&#39;</span><span class="p">,</span> <span class="s1">&#39;--dotfiles&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to $</span><span class="si">{__DOTFILES}</span><span class="s2"> symlink -- ~/-dotfiles&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;__DOTFILES&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--WORKON_HOME&#39;</span><span class="p">,</span> <span class="s1">&#39;--workonhome&#39;</span><span class="p">,</span> <span class="s1">&#39;--wh&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Path to $</span><span class="si">{WORKON_HOME}</span><span class="s2"> directory &quot;</span>
                           <span class="s2">&quot;containing VIRTUAL_ENVs&quot;</span><span class="p">),</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--CONDA_ROOT&#39;</span><span class="p">,</span> <span class="s1">&#39;--condaroot&#39;</span><span class="p">,</span> <span class="s1">&#39;--cr&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Path to $</span><span class="si">{CONDA_ROOT}</span><span class="s2"> directory &quot;</span>
                           <span class="s2">&quot;containing VIRTUAL_ENVs&quot;</span><span class="p">),</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;CONDA_ROOT&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--CONDA_ENVS_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;--condaenvs&#39;</span><span class="p">,</span> <span class="s1">&#39;--ce&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Path to $</span><span class="si">{CONDA_ENVS_PATH}</span><span class="s2"> directory &quot;</span>
                           <span class="s2">&quot;containing VIRTUAL_ENVs&quot;</span><span class="p">),</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;CONDA_ENVS_PATH&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--VENVSTR&#39;</span><span class="p">,</span> <span class="s1">&#39;--venvstr&#39;</span><span class="p">,</span> <span class="s1">&#39;--ve&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Path to VIRTUAL_ENV -- &quot;</span>
                           <span class="s2">&quot;$</span><span class="si">{WORKON_HOME}</span><span class="s2">/$</span><span class="si">{VIRTUAL_ENV_NAME}</span><span class="s2"> &quot;</span>
                           <span class="s2">&quot;(or a dirname in $WORKON_HOME) &quot;</span><span class="p">),</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;VENVSTR_&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">)</span>

    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--VENVSTRAPP&#39;</span><span class="p">,</span> <span class="s1">&#39;--venvstrapp&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Subpath within </span><span class="si">{VIRTUAL_ETC}</span><span class="s2">/src/&quot;</span><span class="p">),</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;VENVSTRAPP_&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">)</span>

    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;--virtual-env-name&#39;</span><span class="p">,</span> <span class="s1">&#39;--vename&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;dirname in WORKON_HOME -- &quot;</span>
                           <span class="s2">&quot;$</span><span class="si">{WORKON_HOME}</span><span class="s2">/$</span><span class="si">{VIRTUAL_ENV_NAME}</span><span class="s2">&quot;</span><span class="p">),</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--VENVPREFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;--venvprefix&#39;</span><span class="p">,</span> <span class="s1">&#39;--prefix&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Prefix for _SRC, _ETC, _WRD if [ -z VIRTUAL_ENV ]&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">)</span>

    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;--virtual-env&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to a $VIRTUAL_ENV&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--_SRC&#39;</span><span class="p">,</span> <span class="s1">&#39;--SRC&#39;</span><span class="p">,</span> <span class="s1">&#39;--src&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to source -- $</span><span class="si">{VIRTUAL_ENV}</span><span class="s1">/src&quot;)&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;_SRC&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--_APP&#39;</span><span class="p">,</span> <span class="s1">&#39;--APP&#39;</span><span class="p">,</span>  <span class="s1">&#39;--app&#39;</span><span class="p">,</span>  <span class="c1"># see also: --VENVSTRAPP</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path component string -- $</span><span class="si">{_SRC}</span><span class="s2">/$</span><span class="si">{_APP}</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;_APP&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">envprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--_WRD&#39;</span><span class="p">,</span> <span class="s1">&#39;--WRD&#39;</span><span class="p">,</span> <span class="s1">&#39;--wrd&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to working directory -- $</span><span class="si">{_SRC}</span><span class="s2">/$</span><span class="si">{_APP}</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;_WRD&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="n">prnprs</span> <span class="o">=</span> <span class="n">prs</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-json&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print venv configuration as JSON&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_json&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-json-filename&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to write venv env JSON to&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_json_filename&#39;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="s1">&#39;venv.json&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-vars&#39;</span><span class="p">,</span> <span class="s1">&#39;--vars&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Print vars&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_vars&#39;</span><span class="p">,</span>
                     <span class="c1"># nargs=&#39;?&#39;,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-bash&#39;</span><span class="p">,</span> <span class="s1">&#39;--bash&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print Bash shell configuration&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_bash&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="c1"># default=&#39;venv.bash.sh&#39;,</span>
                     <span class="p">)</span>

    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-bash-all&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print Bash shell environ and aliases&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_bash_all&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="c1"># default=&#39;venv.bash.sh&#39;,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-bash-aliases&#39;</span><span class="p">,</span> <span class="s1">&#39;--bash-alias&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print Bash alias script&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_bash_aliases&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-bash-cdaliases&#39;</span><span class="p">,</span> <span class="s1">&#39;--bash-cdalias&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print Bash cdalias script&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_bash_cdaliases&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-Z&#39;</span><span class="p">,</span> <span class="s1">&#39;--print-zsh&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print ZSH shell configuration&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_zsh&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-vim-cdalias&#39;</span><span class="p">,</span> <span class="s1">&#39;--vim&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print vimscript configuration &quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;print_vim_cdalias&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--print-ipython-magics&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print IPython magic methods&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;print_venv_ipymagics&quot;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,)</span>

    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--command&#39;</span><span class="p">,</span> <span class="s1">&#39;--cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run a command in a venv-configured shell&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;run_command&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--run-bash&#39;</span><span class="p">,</span> <span class="s1">&#39;--xbash&#39;</span><span class="p">,</span> <span class="s1">&#39;-xb&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run bash in the specified venv&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;run_bash&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--run-make&#39;</span><span class="p">,</span> <span class="s1">&#39;--xmake&#39;</span><span class="p">,</span> <span class="s1">&#39;-xmake&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Run (cd $_WRD; make $@) in the specified venv&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;run_make&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--run-editp&#39;</span><span class="p">,</span> <span class="s1">&#39;--open-editors&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit&#39;</span><span class="p">,</span> <span class="s1">&#39;-E&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Open $EDITOR_ with venv.project_files&quot;</span>
                           <span class="s2">&quot; [$PROJECT_FILES]&quot;</span><span class="p">),</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;open_editors&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--run-terminal&#39;</span><span class="p">,</span> <span class="s1">&#39;--open-terminals&#39;</span><span class="p">,</span> <span class="s1">&#39;--terminals&#39;</span><span class="p">,</span> <span class="s1">&#39;--terms&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Open terminals within the venv [gnome-terminal]&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;open_terminals&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="c1">#subparsers = prs.add_subparsers(help=&#39;subcommands&#39;)</span>
    <span class="c1">#pthprs = subparsers.add_parser(&#39;path&#39;, help=&#39;see: $0 path --help&#39;)</span>
    <span class="n">pthprs</span> <span class="o">=</span> <span class="n">prs</span>


    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--pall&#39;</span><span class="p">,</span> <span class="s1">&#39;--pathall&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print possible paths for the given path&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;all_paths&quot;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--pwrk&#39;</span><span class="p">,</span> <span class="s1">&#39;--wrk-path&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print $__WRK/$@&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;path__WRK&quot;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--pworkonhome&#39;</span><span class="p">,</span> <span class="s1">&#39;--workonhome-path&#39;</span><span class="p">,</span> <span class="s1">&#39;--pwh&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print $__WORKON_HOME/$@&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;path_WORKON_HOME&quot;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--pvirtualenv&#39;</span><span class="p">,</span> <span class="s1">&#39;--virtualenv-path&#39;</span><span class="p">,</span> <span class="s1">&#39;--pv&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print $VIRTUAL_ENV/${@}&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;path_VIRTUAL_ENV&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--psrc&#39;</span><span class="p">,</span> <span class="s1">&#39;--src-path&#39;</span><span class="p">,</span> <span class="s1">&#39;--ps&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print $_SRC/${@}&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;path__SRC&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--pwrd&#39;</span><span class="p">,</span> <span class="s1">&#39;--wrd-path&#39;</span><span class="p">,</span> <span class="s1">&#39;--pw&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print $_WRD/${@}&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;path__WRD&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--pdotfiles&#39;</span><span class="p">,</span> <span class="s1">&#39;--dotfiles-path&#39;</span><span class="p">,</span> <span class="s1">&#39;--pd&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print $</span><span class="si">{__DOTFILES}</span><span class="s2">/$</span><span class="si">{path}</span><span class="s2">&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;path__DOTFILES&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--prel&#39;</span><span class="p">,</span> <span class="s1">&#39;--relative-path&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print ${@}&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;relative_path&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--pkg-resource-path&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path from pkg_resources.TODOTODO&quot;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pkg_resource_path&quot;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="n">pthprs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--compress&#39;</span><span class="p">,</span> <span class="s1">&#39;--compress-paths&#39;</span><span class="p">,</span>
                     <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;compress_paths&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path $VAR-ify the given paths from stdin&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>


    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="p">(</span>
                         <span class="s1">&#39;a name of a virtualenv in WORKON_HOME &#39;</span>
                         <span class="s1">&#39;OR a full path to a VIRTUAL_ENV&#39;</span><span class="p">),</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span>
                     <span class="n">help</span><span class="o">=</span><span class="s2">&quot;a path within _SRC (_WRD=_SRC/VENVSTRAPP)&quot;</span><span class="p">,</span>
                     <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span>
                     <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                     <span class="p">)</span>

    <span class="c1"># Store remaining args in a catchall list (opts.args)</span>
    <span class="n">prs</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">REMAINDER</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prs</span></div>


<div class="viewcode-block" id="comment_comment"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.comment_comment">[docs]</a><span class="k">def</span> <span class="nf">comment_comment</span><span class="p">(</span><span class="n">strblock</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        strblock (str): string block (possibly containing newlines)</span>
<span class="sd">    Keyword Arguments:</span>
<span class="sd">        kwargs (dict): kwargs for prepend_comment_char</span>
<span class="sd">    Returns:</span>
<span class="sd">        str: string with each line prefixed with comment char</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">prepend_comment_char</span><span class="p">(</span><span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">strblock</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../dotfiles.venv.html#dotfiles.venv.venv.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="o">*</span><span class="n">argv</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    main function called if ``__name__==&quot;__main__&quot;``</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: nonzero on error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stderr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stderr&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

    <span class="n">prs</span> <span class="o">=</span> <span class="n">build_venv_arg_parser</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">argv</span><span class="p">:</span>
        <span class="n">_argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_argv</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">_argv</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="c1"># opts.args</span>

    <span class="k">if</span> <span class="ow">not</span>  <span class="n">_argv</span> <span class="ow">and</span> <span class="n">IN_IPYTHON</span><span class="p">:</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">from_environ</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">quiet</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">version</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(levelname)-6s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">LOGNAME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>  <span class="c1"># DEFAULT</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">LOGNAME</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">DEBUG_TRACE_MODPATH</span>
        <span class="n">DEBUG_TRACE_MODPATH</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">trace</span>

    <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;main()&#39;</span><span class="p">,</span>
             <span class="p">{</span><span class="s2">&quot;sys.argv&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">,</span>
              <span class="s2">&quot;*argv&quot;</span><span class="p">:</span> <span class="n">argv</span><span class="p">,</span>
              <span class="s2">&quot;_argv&quot;</span><span class="p">:</span> <span class="n">_argv</span><span class="p">,</span>
              <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
              <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">},</span>
             <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">run_tests</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">opts</span><span class="o">.</span><span class="n">args</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="c1"># TODO: independently __version__ this standalone script</span>
        <span class="c1"># and version-stamp --print-[...]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">dotfiles</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">dotfiles</span><span class="o">.</span><span class="n">version</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">127</span>

    <span class="c1"># build or create a new Env</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">from_environ</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="o">.</span><span class="n">from_environ</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">Env</span><span class="p">()</span>

    <span class="c1"># read variables from options into the initial env dict</span>

    <span class="n">varnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;__WRK&#39;</span><span class="p">,</span> <span class="s1">&#39;__DOTFILES&#39;</span><span class="p">,</span> <span class="s1">&#39;WORKON_HOME&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VENVSTR&#39;</span><span class="p">,</span> <span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">,</span> <span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VIRTUAL_ENV_NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">,</span> <span class="s1">&#39;_SRC&#39;</span><span class="p">,</span> <span class="s1">&#39;_WRD&#39;</span><span class="p">,</span>
                <span class="s1">&#39;CONDA_ROOT&#39;</span><span class="p">,</span> <span class="s1">&#39;CONDA_ENVS_PATH&#39;</span><span class="p">,</span>
                <span class="s1">&#39;CONDA_ENVS_DEFAULT&#39;</span><span class="p">,</span> <span class="s1">&#39;CONDA_ROOT_DEFAULT&#39;</span><span class="p">]</span>

    <span class="c1"># get opts from args and update env</span>
    <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">varnames</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">existing_value</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">existing_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">existing_value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;main args&#39;</span><span class="p">,</span> <span class="p">{</span>
                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="s1">&#39;commandline options intersect with env&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;varname&#39;</span><span class="p">:</span> <span class="n">varname</span><span class="p">,</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;value_was&#39;</span><span class="p">:</span> <span class="n">existing_value</span><span class="p">,</span>
                <span class="p">},</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
            <span class="n">env</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">VENVSTR_</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">VENVSTR_</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">VENVSTRAPP_</span><span class="p">:</span>
        <span class="n">env</span><span class="p">[</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">VENVSTRAPP_</span>

    <span class="n">logevent</span><span class="p">(</span><span class="s1">&#39;main_env&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">((</span>
            <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVPREFIX&#39;</span><span class="p">),</span>
            <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VIRTUAL_ENV&#39;</span><span class="p">),</span>
            <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">),</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">from_environ</span><span class="p">)):</span>
        <span class="n">errmsg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;You must specify one of VENVSTR, VIRTUAL_ENV, VENVPREFIX, &quot;</span>
                  <span class="s2">&quot;or -e|--from-environ&quot;</span><span class="p">)</span>
        <span class="n">prs</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>

        <span class="c1"># TODO: handle paths</span>

    <span class="c1"># virtualenv [, appname]</span>
    <span class="n">venv</span> <span class="o">=</span> <span class="n">Venv</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
                <span class="n">open_editors</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">open_editors</span><span class="p">,</span>
                <span class="n">open_terminals</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">open_terminals</span><span class="p">,</span>
                <span class="n">show_diffs</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">show_diffs</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">stdout</span>

    <span class="n">print_cmd_opts</span> <span class="o">=</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">print_json</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_vars</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_bash</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_bash_aliases</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_bash_cdaliases</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_bash_all</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_zsh</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_vim_cdalias</span><span class="p">,</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">print_venv_ipymagics</span>
                <span class="p">)</span>
    <span class="n">print_cmd</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">print_cmd_opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_vars</span><span class="p">:</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="c1"># TODO: any(print_cmd_opts):</span>
            <span class="n">prs</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;--print-vars specfied when</span><span class="se">\n</span><span class="s2">&quot;</span>
                      <span class="s2">&quot;writing to json, bash, zsh, or vim.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">generate_vars_env</span><span class="p">(</span>
                <span class="n">compress_paths</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_json</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">venv</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_bash_all</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">generate_bash_env</span><span class="p">(</span><span class="n">compress_paths</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">,</span>
                                            <span class="n">include_paths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">include_aliases</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_bash</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">generate_bash_env</span><span class="p">(</span><span class="n">compress_paths</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">,</span>
                                            <span class="n">include_paths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">include_aliases</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_bash_aliases</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">generate_bash_env</span><span class="p">(</span><span class="n">compress_paths</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">,</span>
                                            <span class="n">include_paths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                            <span class="n">include_aliases</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">include_cdaliases</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_bash_cdaliases</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">generate_bash_cdalias</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_vim_cdalias</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">generate_vim_cdalias</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">print_venv_ipymagics</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">venv</span><span class="o">.</span><span class="n">generate_venv_ipymagics</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">run_command</span><span class="p">:</span>
        <span class="n">prcs</span> <span class="o">=</span> <span class="n">venv</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">run_command</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">run_bash</span><span class="p">:</span>
        <span class="n">prcs</span> <span class="o">=</span> <span class="n">venv</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;cd $_WRD; bash&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">run_make</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">argstr</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">prcs</span> <span class="o">=</span> <span class="n">venv</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;cd $_WRD; make </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">argstr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_pkg_resource_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">pkg_resources</span>
        <span class="k">return</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;dotfiles&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">opts</span><span class="o">.</span><span class="n">all_paths</span><span class="p">,</span>
            <span class="c1"># TODO TODO TODO:</span>
            <span class="c1"># is there a way to</span>
            <span class="c1"># distinguish between unset and flag-specified-without-value</span>
            <span class="c1"># with argparse nargs=&#39;?&#39;?</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">path__WRD</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">path__DOTFILES</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">relative_path</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">pkg_resource_path</span><span class="p">)):</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">VENVSTR</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVSTR&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VENVSTR</span><span class="p">:</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VENVSTR</span><span class="p">)</span>
        <span class="n">VENVSTRAPP</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;VENVSTRAPP&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VENVSTRAPP</span><span class="p">:</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VENVSTRAPP</span><span class="p">)</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">basepath</span> <span class="o">=</span> <span class="n">get_pkg_resource_filename</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">all_paths</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">path__DOTFILES</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">__DOTFILES</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__DOTFILES&#39;</span><span class="p">,</span>
                                 <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;-dotfiles&#39;</span><span class="p">))</span>
            <span class="n">env</span><span class="p">[</span><span class="s1">&#39;__DOTFILES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__DOTFILES</span>

        <span class="k">for</span> <span class="n">pth</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">resource_path</span> <span class="o">=</span> <span class="n">get_pkg_resource_filename</span><span class="p">(</span><span class="n">pth</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">all_paths</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">relative_path</span><span class="p">:</span>
                <span class="n">relpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">resource_path</span><span class="p">,</span> <span class="n">basepath</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">relpath</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">all_paths</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">pkg_resource_path</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">resource_path</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">all_paths</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">path__DOTFILES</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dotfiles_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;__DOTFILES&#39;</span><span class="p">],</span> <span class="n">pth</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">dotfiles_path</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stdout</span><span class="p">)</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="n">print_cmd</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">:</span>
        <span class="n">stdin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">stdin</span><span class="p">:</span>
            <span class="n">pathstr</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="c1">#print(pathstr)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">venv</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">compress_paths</span><span class="p">(</span><span class="n">pathstr</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stdout</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">0</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">retcode</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">IN_IPYTHON</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">retcode</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">IN_IPYTHON_CONFIG</span><span class="p">:</span>
        <span class="n">logevent</span><span class="p">(</span><span class="s2">&quot;ipython_main&quot;</span><span class="p">,</span> <span class="s2">&quot;configuring IPython&quot;</span><span class="p">)</span>
        <span class="n">ipython_main</span><span class="p">()</span>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav text-center">
        <li><a href="../../../index.html">westurner/dotfiles 0.9.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav text-center">
      
        <li><a href="../../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../../index.html" >Module code</a></li>
        <li><a href="../../dotfiles.html" >dotfiles</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2019, Wes Turner.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.5.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>